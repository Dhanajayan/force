{"remainingRequest":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.tsx","dependencies":[{"path":"/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.tsx","mtime":1535573774000},{"path":"/Users/eve/development/force/.babelrc","mtime":1537178749000},{"path":"/Users/eve/development/force/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _extend from \"lodash/extend\";\nimport _debounce from \"lodash/debounce\";\nimport _flatten from \"lodash/flatten\";\n\n(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nimport moment from 'moment';\nimport styled from 'styled-components';\nimport React, { Component, Fragment } from 'react';\nimport Waypoint from 'react-waypoint';\nimport { positronql as _positronql } from \"../../../lib/positronql\";\nimport { newsArticlesQuery } from \"../queries/articles\";\nimport { NewsNav } from \"@artsy/reaction/dist/Components/Publishing/Nav/NewsNav\";\nimport { setupFollows, setupFollowButtons } from \"./FollowButton.js\";\nimport { LoadingSpinner } from \"./InfiniteScrollArticle\";\nimport { NewsArticle } from \"./NewsArticle\";\nimport { NewsDateDivider } from \"@artsy/reaction/dist/Components/Publishing/News/NewsDateDivider\";\n// FIXME: Rewire\nvar positronql = _positronql;\nexport var InfiniteScrollNewsArticle =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(InfiniteScrollNewsArticle, _Component);\n\n  function InfiniteScrollNewsArticle(props) {\n    var _this;\n\n    _classCallCheck(this, InfiniteScrollNewsArticle);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(InfiniteScrollNewsArticle).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"fetchNextArticles\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var _this$state, articles, display, following, offset, omit, relatedArticles, data, newArticles, newDisplay, newRelatedArticles;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$state = _this.state, articles = _this$state.articles, display = _this$state.display, following = _this$state.following, offset = _this$state.offset, omit = _this$state.omit, relatedArticles = _this$state.relatedArticles;\n\n              _this.setState({\n                isLoading: true\n              });\n\n              _context.prev = 2;\n              _context.next = 5;\n              return positronql({\n                query: newsArticlesQuery({\n                  offset: offset,\n                  limit: 6,\n                  omit: omit\n                })\n              });\n\n            case 5:\n              data = _context.sent;\n              newArticles = data.articles;\n\n              if (data.display) {\n                newDisplay = _extend({}, data.display, {\n                  renderTime: moment().unix()\n                });\n              }\n\n              newRelatedArticles = [data.relatedArticlesCanvas];\n\n              if (newArticles.length) {\n                _this.setState({\n                  articles: articles.concat(newArticles),\n                  display: display.concat(newDisplay),\n                  relatedArticles: relatedArticles.concat(newRelatedArticles),\n                  isLoading: false,\n                  offset: offset + 6\n                });\n\n                setupFollowButtons(following);\n              } else {\n                _this.setState({\n                  isEnabled: false,\n                  isLoading: false\n                });\n              }\n\n              _context.next = 16;\n              break;\n\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](2);\n              console.error('(apps/article/InfiniteScrollNewsArticle) Error fetching next article set: ', _context.t0);\n\n              _this.setState({\n                isEnabled: false,\n                isLoading: false,\n                error: true\n              });\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this, [[2, 12]]);\n    })));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"renderWaypoint\", function () {\n      var _this$state2 = _this.state,\n          isEnabled = _this$state2.isEnabled,\n          isLoading = _this$state2.isLoading,\n          error = _this$state2.error;\n\n      if (isEnabled) {\n        if (!isLoading) {\n          return React.createElement(Waypoint, {\n            onEnter: _this.fetchNextArticles,\n            bottomOffset: \"-50%\"\n          });\n        } else if (!error) {\n          return React.createElement(LoadingSpinner, null, React.createElement(\"div\", {\n            className: \"loading-spinner\"\n          }));\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"onDateChange\", function (date) {\n      var hasNewDate = !moment(date).isSame(_this.state.date, 'day');\n\n      if (hasNewDate) {\n        _this.setState({\n          date: date\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"onActiveArticleChange\", function (id) {\n      _this.setState({\n        activeArticle: id\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"hasNewDate\", function (article, i) {\n      var articles = _this.state.articles;\n      var beforeArticle = articles[i - 1] || {};\n\n      var beforeDate = _this.getDateField(beforeArticle).substring(0, 10);\n\n      var currentDate = _this.getDateField(article).substring(0, 10);\n\n      return beforeDate !== currentDate;\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"getDateField\", function (article) {\n      var published_at = article.published_at,\n          scheduled_publish_at = article.scheduled_publish_at;\n      return published_at || scheduled_publish_at || moment().toISOString();\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"renderContent\", function () {\n      var _this$state3 = _this.state,\n          activeArticle = _this$state3.activeArticle,\n          articles = _this$state3.articles,\n          display = _this$state3.display,\n          relatedArticles = _this$state3.relatedArticles;\n      var _this$props = _this.props,\n          isMobile = _this$props.isMobile,\n          renderTime = _this$props.renderTime;\n      var counter = 0;\n      return _flatten(articles.map(function (article, i) {\n        var hasMetaContent = i % 6 === 0 && i !== 0;\n        var displayAd = display[counter];\n        var related = relatedArticles[counter];\n\n        if (hasMetaContent) {\n          counter++;\n        }\n\n        var isTruncated = !_this.props.article || i !== 0;\n\n        var hasDateDivider = i !== 0 && _this.hasNewDate(article, i);\n\n        var relatedArticlesCanvas = hasMetaContent && related;\n        var displayCanvas = hasMetaContent && displayAd;\n        var hasRenderTime = hasMetaContent && (displayAd && displayAd.renderTime || renderTime);\n        return React.createElement(Fragment, {\n          key: \"article-\".concat(i)\n        }, hasDateDivider && React.createElement(NewsDateDivider, {\n          date: article.published_at\n        }), React.createElement(NewsArticle, {\n          isMobile: isMobile,\n          article: article,\n          isTruncated: isTruncated,\n          onDateChange: function onDateChange(date) {\n            return _this.onDateChange(date);\n          },\n          nextArticle: articles[i + 1],\n          onActiveArticleChange: function onActiveArticleChange(id) {\n            return _this.onActiveArticleChange(id);\n          },\n          isActive: activeArticle === article.id,\n          relatedArticlesForCanvas: relatedArticlesCanvas,\n          display: displayCanvas,\n          renderTime: hasRenderTime\n        }));\n      }));\n    });\n\n    var _article = props.articles[0] || {};\n\n    var _date = _this.getDateField(_article);\n\n    var _omit = props.article ? props.article.id : null;\n\n    var _offset = props.article ? 0 : 6;\n\n    _this.onDateChange = _debounce(_this.onDateChange, 200);\n    _this.state = {\n      activeArticle: '',\n      articles: props.articles,\n      date: _date,\n      display: [],\n      error: false,\n      following: setupFollows() || null,\n      isEnabled: true,\n      isLoading: false,\n      offset: _offset,\n      omit: _omit,\n      relatedArticles: []\n    };\n    return _this;\n  }\n\n  _createClass(InfiniteScrollNewsArticle, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      setupFollowButtons(this.state.following);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var isMobile = this.props.isMobile;\n      var date = this.state.date;\n      return React.createElement(NewsContainer, {\n        isMobile: isMobile,\n        id: \"article-root\"\n      }, React.createElement(NewsNav, {\n        date: date,\n        positionTop: 61\n      }), this.renderContent(), this.renderWaypoint());\n    }\n  }, {\n    key: \"__reactstandin__regenerateByEval\",\n    value: function __reactstandin__regenerateByEval(key, code) {\n      this[key] = eval(code);\n    }\n  }]);\n\n  return InfiniteScrollNewsArticle;\n}(Component);\nvar NewsContainer =\n/*#__PURE__*/\nstyled.div.attrs({}).withConfig({\n  displayName: \"InfiniteScrollNewsArticle__NewsContainer\",\n  componentId: \"s18wrl58-0\"\n})([\"margin-top:\", \"px;\"], function (props) {\n  return props.isMobile ? '100' : '200';\n});\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(positronql, \"positronql\", \"/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.tsx\");\n  reactHotLoader.register(InfiniteScrollNewsArticle, \"InfiniteScrollNewsArticle\", \"/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.tsx\");\n  reactHotLoader.register(NewsContainer, \"NewsContainer\", \"/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.tsx\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.tsx"],"names":["moment","styled","React","Component","Fragment","Waypoint","positronql","_positronql","newsArticlesQuery","NewsNav","setupFollows","setupFollowButtons","LoadingSpinner","NewsArticle","NewsDateDivider","InfiniteScrollNewsArticle","props","state","articles","display","following","offset","omit","relatedArticles","setState","isLoading","query","limit","data","newArticles","newDisplay","renderTime","unix","newRelatedArticles","relatedArticlesCanvas","length","concat","isEnabled","console","error","fetchNextArticles","date","hasNewDate","isSame","id","activeArticle","article","i","beforeArticle","beforeDate","getDateField","substring","currentDate","published_at","scheduled_publish_at","toISOString","isMobile","counter","map","hasMetaContent","displayAd","related","isTruncated","hasDateDivider","displayCanvas","hasRenderTime","onDateChange","onActiveArticleChange","renderContent","renderWaypoint","NewsContainer","div","attrs"],"mappings":"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","sourcesContent":["import moment from 'moment'\nimport styled from 'styled-components'\nimport React, { Component, Fragment } from 'react'\nimport { flatten, debounce, extend } from 'lodash'\nimport Waypoint from 'react-waypoint'\nimport { positronql as _positronql } from 'desktop/lib/positronql'\nimport { newsArticlesQuery } from 'desktop/apps/article/queries/articles'\nimport {\n  ArticleData,\n  RelatedArticleCanvasData,\n  DisplayData,\n} from 'reaction/Components/Publishing/Typings'\nimport { NewsNav } from 'reaction/Components/Publishing/Nav/NewsNav'\nimport { setupFollows, setupFollowButtons } from './FollowButton.js'\nimport { LoadingSpinner } from './InfiniteScrollArticle'\nimport { NewsArticle } from './NewsArticle'\nimport { NewsDateDivider } from 'reaction/Components/Publishing/News/NewsDateDivider'\n\nexport interface Props {\n  article?: ArticleData\n  articles: ArticleData[]\n  isMobile: boolean\n  renderTime?: number\n}\n\ninterface State {\n  activeArticle: string\n  articles: ArticleData[]\n  date: string\n  display: DisplayData[]\n  error: boolean\n  following: object[]\n  isEnabled: boolean\n  isLoading: boolean\n  offset: number\n  omit: string\n  relatedArticles: RelatedArticleCanvasData[]\n}\n\n// FIXME: Rewire\nlet positronql = _positronql\n\nexport class InfiniteScrollNewsArticle extends Component<Props, State> {\n  constructor(props) {\n    super(props)\n\n    const article = props.articles[0] || {}\n    const date = this.getDateField(article)\n    const omit = props.article ? props.article.id : null\n    const offset = props.article ? 0 : 6\n\n    this.onDateChange = debounce(this.onDateChange, 200)\n\n    this.state = {\n      activeArticle: '',\n      articles: props.articles,\n      date,\n      display: [],\n      error: false,\n      following: setupFollows() || null,\n      isEnabled: true,\n      isLoading: false,\n      offset,\n      omit,\n      relatedArticles: [],\n    }\n  }\n\n  componentDidMount() {\n    setupFollowButtons(this.state.following)\n  }\n\n  fetchNextArticles = async () => {\n    const {\n      articles,\n      display,\n      following,\n      offset,\n      omit,\n      relatedArticles,\n    } = this.state\n\n    this.setState({\n      isLoading: true,\n    })\n\n    try {\n      const data = await positronql({\n        query: newsArticlesQuery({\n          offset,\n          limit: 6,\n          omit,\n        }),\n      })\n\n      const newArticles = data.articles\n\n      let newDisplay\n      if (data.display) {\n        newDisplay = extend({}, data.display, {\n          renderTime: moment().unix(),\n        })\n      }\n      const newRelatedArticles = [data.relatedArticlesCanvas]\n\n      if (newArticles.length) {\n        this.setState({\n          articles: articles.concat(newArticles),\n          display: display.concat(newDisplay),\n          relatedArticles: relatedArticles.concat(newRelatedArticles),\n          isLoading: false,\n          offset: offset + 6,\n        })\n        setupFollowButtons(following)\n      } else {\n        this.setState({\n          isEnabled: false,\n          isLoading: false,\n        })\n      }\n    } catch (error) {\n      console.error(\n        '(apps/article/InfiniteScrollNewsArticle) Error fetching next article set: ',\n        error\n      )\n\n      this.setState({\n        isEnabled: false,\n        isLoading: false,\n        error: true,\n      })\n    }\n  }\n\n  renderWaypoint = () => {\n    const { isEnabled, isLoading, error } = this.state\n\n    if (isEnabled) {\n      if (!isLoading) {\n        return <Waypoint onEnter={this.fetchNextArticles} bottomOffset=\"-50%\" />\n      } else if (!error) {\n        return (\n          <LoadingSpinner>\n            <div className=\"loading-spinner\" />\n          </LoadingSpinner>\n        )\n      }\n    }\n  }\n\n  onDateChange = date => {\n    const hasNewDate = !moment(date).isSame(this.state.date, 'day')\n    if (hasNewDate) {\n      this.setState({ date })\n    }\n  }\n\n  onActiveArticleChange = id => {\n    this.setState({ activeArticle: id })\n  }\n\n  hasNewDate = (article, i) => {\n    const { articles } = this.state\n    const beforeArticle = articles[i - 1] || {}\n    const beforeDate = this.getDateField(beforeArticle).substring(0, 10)\n    const currentDate = this.getDateField(article).substring(0, 10)\n\n    return beforeDate !== currentDate\n  }\n\n  getDateField = article => {\n    const { published_at, scheduled_publish_at } = article\n    return published_at || scheduled_publish_at || moment().toISOString()\n  }\n\n  renderContent = () => {\n    const { activeArticle, articles, display, relatedArticles } = this.state\n    const { isMobile, renderTime } = this.props\n\n    let counter = 0\n\n    return flatten(\n      articles.map((article, i) => {\n        const hasMetaContent = i % 6 === 0 && i !== 0\n        const displayAd = display[counter]\n        const related = relatedArticles[counter]\n        if (hasMetaContent) {\n          counter++\n        }\n        const isTruncated = !this.props.article || i !== 0\n        const hasDateDivider = i !== 0 && this.hasNewDate(article, i)\n        const relatedArticlesCanvas = hasMetaContent && related\n        const displayCanvas = hasMetaContent && displayAd\n        const hasRenderTime =\n          hasMetaContent && ((displayAd && displayAd.renderTime) || renderTime)\n\n        return (\n          <Fragment key={`article-${i}`}>\n            {hasDateDivider && <NewsDateDivider date={article.published_at} />}\n            <NewsArticle\n              isMobile={isMobile}\n              article={article}\n              isTruncated={isTruncated}\n              onDateChange={date => this.onDateChange(date)}\n              nextArticle={articles[i + 1] as any}\n              onActiveArticleChange={id => this.onActiveArticleChange(id)}\n              isActive={activeArticle === article.id}\n              relatedArticlesForCanvas={relatedArticlesCanvas as any}\n              display={displayCanvas as any}\n              renderTime={hasRenderTime as any}\n            />\n          </Fragment>\n        )\n      })\n    )\n  }\n\n  render() {\n    const { isMobile } = this.props\n    const { date } = this.state\n\n    return (\n      <NewsContainer isMobile={isMobile} id=\"article-root\">\n        <NewsNav date={date} positionTop={61} />\n        {this.renderContent()}\n        {this.renderWaypoint()}\n      </NewsContainer>\n    )\n  }\n}\n\nconst NewsContainer = styled.div.attrs<{ isMobile: boolean }>({})`\n  margin-top: ${props => (props.isMobile ? '100' : '200')}px;\n`\n"]}]}