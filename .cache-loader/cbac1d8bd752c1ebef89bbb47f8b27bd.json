{"remainingRequest":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/eve/development/force/src/desktop/analytics/account_creation.js","dependencies":[{"path":"/Users/eve/development/force/src/desktop/analytics/account_creation.js","mtime":1531409003000},{"path":"/Users/eve/development/force/.babelrc","mtime":1528124541000},{"path":"/Users/eve/development/force/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _mediator = _interopRequireDefault(require(\"../lib/mediator.coffee\"));\n\n//\n// Generic events for tracking events around account creation.\n//\nvar getUrlParameter = function getUrlParameter(name) {\n  name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n  var regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\n  var results = regex.exec(location.search);\n  return results === null ? undefined : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n};\n\nvar getAcquisitionInitiative = function getAcquisitionInitiative() {\n  return getUrlParameter('m-id') || getUrlParameter('acquisition_initiative');\n};\n\nvar trackAccountCreation = function trackAccountCreation(options) {\n  analytics.track('Created account', options);\n  analytics.identify(options.user_id, _.pick(options, 'email'), {\n    integrations: {\n      All: false,\n      Marketo: true\n    }\n  });\n}; // Created account (via email)\n\n\n$(document).one('submit', '.auth-register form, .marketing-signup-modal form, .artist-page-cta-overlay__register form, .gdpr-signup form', function () {\n  $(document).one('ajaxComplete', function (e, xhr, options) {\n    return _mediator.default.trigger('auth:sign_up:email', {\n      acquisition_initiative: getAcquisitionInitiative(),\n      signup_service: 'email',\n      user_id: xhr.responseJSON.user.id,\n      context: options.context,\n      email: xhr.responseJSON.user.email\n    });\n  });\n}); // Created account (via social)\n// 1. Upon clicking the social signup button\n\n$(document).on('click', '.auth-signup-facebook, .gdpr-signup__fb', function (e) {\n  // 2. Store some data in cookies before being redirected everywhere\n  _mediator.default.trigger('auth:sign_up:fb', {\n    service: 'facebook',\n    acquisition_initiative: getAcquisitionInitiative(),\n    context: $(e.currentTarget).data('context')\n  });\n}); // 3. After landing back on Artsy send the tracking call and expire the cookie\n\nif (Cookies.get('analytics-signup')) {\n  var data = JSON.parse(Cookies.get('analytics-signup'));\n  Cookies.expire('analytics-signup');\n\n  if (sd.CURRENT_USER) {\n    trackAccountCreation((0, _extends2.default)({}, data, {\n      user_id: sd.CURRENT_USER.id\n    }));\n  }\n\n  analyticsHooks.on('auth:login', function () {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    analytics.track('Successfully logged in', options);\n  }); // Triggered sign up form via save button\n\n  if (!sd.CURRENT_USER) {\n    $('.artwork-item-image-container .overlay-button-save').click(function () {\n      analytics.track('Triggered sign up form via save button');\n    });\n  } // Triggered sign up form via follow button\n\n\n  if (!sd.CURRENT_USER) {\n    $('.follow-button, .entity-follow').click(function () {\n      analytics.track('Triggered sign up form via follow button');\n    });\n  } // Clicked sign up via the header\n\n\n  $('.mlh-signup').click(function () {\n    analytics.track('Clicked sign up via the header');\n  }); // Clicked sign out via the header\n\n  $('.mlh-logout').click(function () {\n    analytics.track('Clicked logout via the header');\n  }); // Viewed sign up options\n\n  var trackViewSignup = function trackViewSignup() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    analytics.track('Viewed sign up options', options);\n  };\n\n  analyticsHooks.on('mediator:open:auth', function () {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (options.mode === 'signup') trackViewSignup(options);\n    analytics.trackLink($('.auth-signup-facebook')[0], 'Created account');\n    analytics.trackLink($('.auth-signup-twitter')[0], 'Created account');\n  });\n  $('#auth-footer [href*=sign_up]').click(trackViewSignup); // Created account via consignments submission page\n\n  analyticsHooks.on('consignment:account:created', function (options) {\n    if (options.accountCreated) {\n      trackAccountCreation({\n        signup_service: 'email',\n        user_id: options.id,\n        context: 'consignments',\n        email: options.email\n      });\n    } else {\n      analytics.identify(options.user_id, options.email, {\n        integrations: {\n          All: false,\n          Marketo: true\n        }\n      });\n    }\n  });\n}",{"version":3,"sources":["src/desktop/analytics/account_creation.js"],"names":["getUrlParameter","name","replace","regex","RegExp","results","exec","location","search","undefined","decodeURIComponent","getAcquisitionInitiative","trackAccountCreation","analytics","track","options","identify","user_id","_","pick","integrations","All","Marketo","$","document","one","e","xhr","trigger","acquisition_initiative","signup_service","responseJSON","user","id","context","email","on","service","currentTarget","data","Cookies","get","JSON","parse","expire","sd","CURRENT_USER","analyticsHooks","click","trackViewSignup","mode","trackLink","accountCreated"],"mappings":"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","file":"/Users/eve/development/force/src/desktop/analytics/account_creation.js","sourceRoot":"/Users/eve/development/force","sourcesContent":["import mediator from '../lib/mediator.coffee'\n//\n// Generic events for tracking events around account creation.\n//\n\nconst getUrlParameter = name => {\n  name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]')\n  let regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)')\n  let results = regex.exec(location.search)\n  return results === null\n    ? undefined\n    : decodeURIComponent(results[1].replace(/\\+/g, ' '))\n}\n\nconst getAcquisitionInitiative = () =>\n  getUrlParameter('m-id') || getUrlParameter('acquisition_initiative')\n\nconst trackAccountCreation = options => {\n  analytics.track('Created account', options)\n\n  analytics.identify(options.user_id, _.pick(options, 'email'), {\n    integrations: {\n      All: false,\n      Marketo: true,\n    },\n  })\n}\n\n// Created account (via email)\n$(document).one(\n  'submit',\n  '.auth-register form, .marketing-signup-modal form, .artist-page-cta-overlay__register form, .gdpr-signup form',\n  () => {\n    $(document).one('ajaxComplete', (e, xhr, options) =>\n      mediator.trigger('auth:sign_up:email', {\n        acquisition_initiative: getAcquisitionInitiative(),\n        signup_service: 'email',\n        user_id: xhr.responseJSON.user.id,\n        context: options.context,\n        email: xhr.responseJSON.user.email,\n      })\n    )\n  }\n)\n\n// Created account (via social)\n\n// 1. Upon clicking the social signup button\n$(document).on('click', '.auth-signup-facebook, .gdpr-signup__fb', e => {\n  // 2. Store some data in cookies before being redirected everywhere\n  mediator.trigger('auth:sign_up:fb', {\n    service: 'facebook',\n    acquisition_initiative: getAcquisitionInitiative(),\n    context: $(e.currentTarget).data('context'),\n  })\n})\n\n// 3. After landing back on Artsy send the tracking call and expire the cookie\nif (Cookies.get('analytics-signup')) {\n  var data = JSON.parse(Cookies.get('analytics-signup'))\n  Cookies.expire('analytics-signup')\n\n  if (sd.CURRENT_USER) {\n    trackAccountCreation({\n      ...data,\n      user_id: sd.CURRENT_USER.id,\n    })\n  }\n\n  analyticsHooks.on('auth:login', (options = {}) => {\n    analytics.track('Successfully logged in', options)\n  })\n\n  // Triggered sign up form via save button\n  if (!sd.CURRENT_USER) {\n    $('.artwork-item-image-container .overlay-button-save').click(function() {\n      analytics.track('Triggered sign up form via save button')\n    })\n  }\n\n  // Triggered sign up form via follow button\n  if (!sd.CURRENT_USER) {\n    $('.follow-button, .entity-follow').click(function() {\n      analytics.track('Triggered sign up form via follow button')\n    })\n  }\n\n  // Clicked sign up via the header\n  $('.mlh-signup').click(function() {\n    analytics.track('Clicked sign up via the header')\n  })\n\n  // Clicked sign out via the header\n  $('.mlh-logout').click(function() {\n    analytics.track('Clicked logout via the header')\n  })\n\n  // Viewed sign up options\n  var trackViewSignup = (options = {}) => {\n    analytics.track('Viewed sign up options', options)\n  }\n\n  analyticsHooks.on('mediator:open:auth', (options = {}) => {\n    if (options.mode === 'signup') trackViewSignup(options)\n\n    analytics.trackLink($('.auth-signup-facebook')[0], 'Created account')\n    analytics.trackLink($('.auth-signup-twitter')[0], 'Created account')\n  })\n\n  $('#auth-footer [href*=sign_up]').click(trackViewSignup)\n\n  // Created account via consignments submission page\n  analyticsHooks.on('consignment:account:created', function(options) {\n    if (options.accountCreated) {\n      trackAccountCreation({\n        signup_service: 'email',\n        user_id: options.id,\n        context: 'consignments',\n        email: options.email,\n      })\n    } else {\n      analytics.identify(options.user_id, options.email, {\n        integrations: {\n          All: false,\n          Marketo: true,\n        },\n      })\n    }\n  })\n}\n"]}]}