{"remainingRequest":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/eve/development/force/src/desktop/apps/gene/client.js","dependencies":[{"path":"/Users/eve/development/force/src/desktop/apps/gene/client.js","mtime":1521064654000},{"path":"/Users/eve/development/force/.babelrc","mtime":1528124541000},{"path":"/Users/eve/development/force/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _assign = _interopRequireDefault(require(\"@babel/runtime/core-js/object/assign\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _jquery = _interopRequireDefault(require(\"jquery\"));\n\nvar _imagesloaded = _interopRequireDefault(require(\"imagesloaded\"));\n\nvar _querystring = _interopRequireDefault(require(\"querystring\"));\n\nvar _sharify = require(\"sharify\");\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactDom = _interopRequireDefault(require(\"react-dom\"));\n\nvar _Gene = require(\"@artsy/reaction/dist/Components/Gene\");\n\nvar _Artsy = require(\"@artsy/reaction/dist/Components/Artsy\");\n\nvar _gene = _interopRequireDefault(require(\"../../models/gene.coffee\"));\n\nvar _current_user = _interopRequireDefault(require(\"../../models/current_user.coffee\"));\n\nvar _index = require(\"../../components/follow_button/index.coffee\");\n\nvar _view = _interopRequireDefault(require(\"../../components/share/view.coffee\"));\n\nvar _gene_genes = _interopRequireDefault(require(\"../../components/related_links/types/gene_genes.coffee\"));\n\nvar _index2 = _interopRequireDefault(require(\"../../components/gradient_blurb/index.coffee\"));\n\n_imagesloaded.default.makeJQueryPlugin(_jquery.default);\n\nvar relatedArtistsTemplate = function relatedArtistsTemplate(args) {\n  return require(\"./templates/related_artists.jade\")(args);\n}; // Update URL with current filters/mode/sort, for ease of sharing.\n\n\nvar onStateChange = function onStateChange(_ref) {\n  var filters = _ref.filters,\n      sort = _ref.sort,\n      mode = _ref.mode;\n  var params;\n\n  if (mode === 'artists') {\n    params = {\n      mode: mode\n    };\n  } else {\n    params = (0, _extends2.default)({}, filters, {\n      sort: sort,\n      mode: mode\n    });\n  }\n\n  var fragment = '?' + _querystring.default.stringify(params);\n\n  window.history.replaceState({}, new _gene.default(_sharify.data.GENE).toPageTitle(), fragment);\n};\n\nfunction setupGenePage() {\n  // Pull out sort and filters from URL, if present\n  var urlParams = _querystring.default.parse(location.search.replace(/^\\?/, ''));\n\n  var sort, mode;\n\n  if (urlParams.sort) {\n    sort = urlParams.sort;\n    delete urlParams.sort;\n  }\n\n  if (urlParams.mode) {\n    mode = urlParams.mode;\n    delete urlParams.mode;\n  } else {\n    mode = _sharify.data.MODE === 'artist' ? 'artists' : _sharify.data.MODE;\n  }\n\n  var options = (0, _assign.default)({}, {\n    sort: sort\n  }, {\n    filters: (0, _extends2.default)({}, urlParams)\n  }, {\n    geneID: _sharify.data.GENE.id,\n    mode: mode\n  });\n\n  var user = _current_user.default.orNull();\n\n  _reactDom.default.render(_react.default.createElement(_Artsy.ContextProvider, {\n    currentUser: user ? user.toJSON() : null\n  }, _react.default.createElement(_Gene.Contents, (0, _extends2.default)({}, options, {\n    onStateChange: onStateChange\n  }))), document.getElementById('gene-filter')); // Load related artists\n\n\n  var gene = new _gene.default(_sharify.data.GENE);\n  gene.relatedArtists.on('sync', function (artists) {\n    var html = relatedArtistsTemplate({\n      artists: artists.models\n    });\n    (0, _jquery.default)('.related-artists').html(html).addClass('is-fade-in');\n  });\n  gene.fetchArtists('related'); // Setup user\n\n  var following = user ? new _index.Following(null, {\n    kind: 'gene'\n  }) : null;\n  new _index.FollowButton({\n    el: (0, _jquery.default)('.follow-button'),\n    following: following,\n    modelName: 'gene',\n    model: gene,\n    context_page: 'Gene page'\n  });\n  if (following) following.syncFollows([gene.id]); // Setup share view\n\n  new _view.default({\n    el: (0, _jquery.default)('.js-gene-share-buttons')\n  }); // Setup blurb\n\n  (0, _index2.default)((0, _jquery.default)('.js-gene-blurb'), {\n    limit: 250\n  }); // Setup related gene view\n\n  new _gene_genes.default({\n    el: (0, _jquery.default)('.main-layout-container .related-genes'),\n    id: gene.id\n  });\n}\n\nvar _default = {\n  setupGenePage: setupGenePage\n};\nexports.default = _default;",{"version":3,"sources":["src/desktop/apps/gene/client.js"],"names":["makeJQueryPlugin","relatedArtistsTemplate","args","require","onStateChange","filters","sort","mode","params","fragment","stringify","window","history","replaceState","GENE","toPageTitle","setupGenePage","urlParams","parse","location","search","replace","MODE","options","geneID","id","user","orNull","render","toJSON","document","getElementById","gene","relatedArtists","on","artists","html","models","addClass","fetchArtists","following","kind","el","modelName","model","context_page","syncFollows","limit"],"mappings":"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","file":"/Users/eve/development/force/src/desktop/apps/gene/client.js","sourceRoot":"/Users/eve/development/force","sourcesContent":["import $ from 'jquery'\n\nimport imagesLoaded from 'imagesloaded'\nimagesLoaded.makeJQueryPlugin($)\n\nimport qs from 'querystring'\nimport { data as sd } from 'sharify'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport { Contents } from 'reaction/Components/Gene'\nimport { ContextProvider } from 'reaction/Components/Artsy'\n\nimport Gene from '../../models/gene.coffee'\nimport CurrentUser from '../../models/current_user.coffee'\nimport {\n  Following,\n  FollowButton,\n} from '../../components/follow_button/index.coffee'\nimport ShareView from '../../components/share/view.coffee'\nimport RelatedGenesView from '../../components/related_links/types/gene_genes.coffee'\nimport blurb from '../../components/gradient_blurb/index.coffee'\n\nconst relatedArtistsTemplate = (args) => {\n  return require('./templates/related_artists.jade')(args)\n}\n\n// Update URL with current filters/mode/sort, for ease of sharing.\nconst onStateChange = ({ filters, sort, mode }) => {\n  let params\n  if (mode === 'artists') {\n    params = { mode }\n  } else {\n    params = { ...filters, sort, mode }\n  }\n  const fragment = '?' + qs.stringify(params)\n  window.history.replaceState({}, new Gene(sd.GENE).toPageTitle(), fragment)\n}\n\nfunction setupGenePage() {\n  // Pull out sort and filters from URL, if present\n  const urlParams = qs.parse(location.search.replace(/^\\?/, ''))\n  let sort, mode\n  if (urlParams.sort) {\n    sort = urlParams.sort\n    delete urlParams.sort\n  }\n  if (urlParams.mode) {\n    mode = urlParams.mode\n    delete urlParams.mode\n  } else {\n    mode = sd.MODE === 'artist' ? 'artists' : sd.MODE\n  }\n\n  const options = Object.assign(\n    {},\n    { sort },\n    { filters: { ...urlParams } },\n    { geneID: sd.GENE.id, mode }\n  )\n  const user = CurrentUser.orNull()\n  ReactDOM.render(\n    <ContextProvider currentUser={user ? user.toJSON() : null}>\n      <Contents {...options} onStateChange={onStateChange} />\n    </ContextProvider>,\n    document.getElementById('gene-filter')\n  )\n\n  // Load related artists\n  const gene = new Gene(sd.GENE)\n  gene.relatedArtists.on('sync', (artists) => {\n    const html = relatedArtistsTemplate({\n      artists: artists.models,\n    })\n\n    $('.related-artists')\n      .html(html)\n      .addClass('is-fade-in')\n  })\n  gene.fetchArtists('related')\n\n  // Setup user\n  const following = user ? new Following(null, { kind: 'gene' }) : null\n  new FollowButton({\n    el: $('.follow-button'),\n    following: following,\n    modelName: 'gene',\n    model: gene,\n    context_page: 'Gene page',\n  })\n  if (following) following.syncFollows([gene.id])\n\n  // Setup share view\n  new ShareView({ el: $('.js-gene-share-buttons') })\n\n  // Setup blurb\n  blurb($('.js-gene-blurb'), { limit: 250 })\n\n  // Setup related gene view\n  new RelatedGenesView({\n    el: $('.main-layout-container .related-genes'),\n    id: gene.id,\n  })\n}\n\nexport default { setupGenePage }\n"]}]}