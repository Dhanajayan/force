{"remainingRequest":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/eve/development/force/src/desktop/analytics/article_impressions.js","dependencies":[{"path":"/Users/eve/development/force/src/desktop/analytics/article_impressions.js","mtime":1519227435000},{"path":"/Users/eve/development/force/.babelrc","mtime":1528124541000},{"path":"/Users/eve/development/force/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["var $ = require('jquery');\n\nvar _ = require('underscore');\n\nif (location.pathname.match('/article/') || location.pathname.match('/articles')) {\n  var trackedImpressions = [];\n\n  var findVisibleItems = function findVisibleItems(articleItems) {\n    if (articleItems.length > 0) {\n      var items = $(articleItems).filter(function () {\n        var viewportTop = $(window).scrollTop();\n        var viewportBottom = viewportTop + $(window).height();\n        var itemTop = $(this).offset().top;\n        var itemBottom = itemTop + $(this).outerHeight(); // Either item top or item bottom is below the top\n        // of the browser and above the fold.\n\n        var topInView = itemTop > viewportTop && itemTop < viewportBottom;\n        var bottomInView = itemBottom > viewportTop && itemBottom < viewportBottom;\n        return topInView || bottomInView;\n      }).map(function () {\n        var classList = $(this).prop('classList');\n        var articleId = $(this).closest('.article-container').data('id'); // Editorial Signup\n\n        if (classList.contains('articles-es-cta__form')) {\n          if (location.pathname.match('/article/')) {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'article_fixed',\n              article_id: articleId,\n              destination_path: null,\n              id: 'article_fixed'\n            };\n          } else {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'magazine_fixed',\n              destination_path: null,\n              id: 'magazine_fixed'\n            };\n          }\n        } else if (classList.contains('article-es-form')) {\n          if ($(this).parents('.is-expanded')) {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'article_fixed',\n              article_id: articleId,\n              destination_path: null,\n              id: 'article_fixed'\n            };\n          } // Social\n\n        } else if (classList.contains('article-social')) {\n          var article = $(this).closest('.article-content');\n\n          if (article.hasClass('gradient-blurb') && article.hasClass('is-expanded') || !article.hasClass('gradient-blurb')) {\n            return {\n              article_id: articleId,\n              destination_path: null,\n              impression_type: 'social',\n              context_type: 'article_fixed',\n              id: 'social:' + articleId\n            };\n          }\n        } else if (classList.contains('article-share-fixed-fullscreen')) {\n          var indArticleId = $(this).data('id');\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'social',\n            context_type: 'article_fixed',\n            id: 'social:' + indArticleId // Image Set\n\n          };\n        } else if (classList.contains('article-section-image-set')) {\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'image_set',\n            context_type: 'article_fixed',\n            id: 'image_set:' + articleId + ':' + $(this).data('index') // Related Article\n\n          };\n        } else if (classList.contains('article-related-widget')) {\n          var related = $(this).find('a');\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'related_article',\n            context_type: 'article_fixed',\n            id: 'related_articles:' + trackRelatedLinks(related) // Artist Follow\n\n          };\n        } else if (classList.contains('artist-follow')) {\n          var _article = $(this).closest('.article-content');\n\n          if (_article.hasClass('gradient-blurb') && _article.hasClass('is-expanded') || !_article.hasClass('gradient-blurb')) {\n            if ($(this).parent('.image-set-modal__container').length > 0) {\n              return {\n                article_id: articleId,\n                destination_path: null,\n                impression_type: 'artist_follow',\n                context_type: 'article_fixed',\n                context_module: 'article_image_set',\n                id: 'artist_follow:' + 'image set' + ':' + $(this).data('id')\n              };\n            } else {\n              return {\n                article_id: articleId,\n                destination_path: null,\n                impression_type: 'artist_follow',\n                context_type: 'article_fixed',\n                context_module: 'article_artist_follow',\n                id: 'artist_follow:' + articleId + ':' + $(this).data('id')\n              };\n            }\n          }\n        } else if (classList.contains('article-section-callout') && $(this)[0].href) {\n          var destinationPath = $(this)[0].href.replace(/^.*\\/\\/[^\\/]+/, '');\n          return {\n            article_id: articleId,\n            destination_path: destinationPath,\n            impression_type: 'article_callout',\n            context_type: 'article_fixed',\n            id: 'article_callout:' + articleId + ':' + destinationPath\n          };\n        } else {}\n      }).toArray(); // Don't double track the same impressions\n\n      items = _.filter(items, function (item) {\n        return !_.contains(trackedImpressions, item.id);\n      });\n      trackedImpressions = trackedImpressions.concat(_.pluck(items, 'id')); // Return only the new impressions\n\n      return items;\n    } else {\n      return [];\n    }\n  };\n\n  var trackImpressions = function trackImpressions() {\n    var itemSelectors = '.articles-es-cta__form, .article-es-form,' + '.article-social, .article-share-fixed-fullscreen,' + '.article-section-image-set,' + '.article-section-toc, .article-sa-sticky-header.visible,' + '.article-sa-related,' + '.artist-follow,' + '.article-section-callout,' + '.article-related-widget';\n    var items = $(itemSelectors);\n    var visibleItems = findVisibleItems(items);\n\n    if (visibleItems.length > 0) {\n      visibleItems.map(function (item) {\n        trackImpression({\n          message: 'Article Impression',\n          context: item\n        });\n      });\n    }\n  };\n\n  var trackRelatedLinks = function trackRelatedLinks(related) {\n    var links = [];\n    related.map(function (i, link) {\n      links.push(link.href.replace(/^.*\\/\\/[^\\/]+/, ''));\n    });\n    return links;\n  };\n\n  var trackImpression = function trackImpression(item) {\n    analytics.track(item.message, item.context);\n  };\n\n  $(window).on('scroll', _.throttle(trackImpressions, 500));\n  analyticsHooks.on('view:image-set-item', function () {\n    trackImpressions();\n  });\n}",{"version":3,"sources":["src/desktop/analytics/article_impressions.js"],"names":["$","require","_","location","pathname","match","trackedImpressions","findVisibleItems","articleItems","length","items","filter","viewportTop","window","scrollTop","viewportBottom","height","itemTop","offset","top","itemBottom","outerHeight","topInView","bottomInView","map","classList","prop","articleId","closest","data","contains","impression_type","context_type","article_id","destination_path","id","parents","article","hasClass","indArticleId","related","find","trackRelatedLinks","parent","context_module","href","destinationPath","replace","toArray","item","concat","pluck","trackImpressions","itemSelectors","visibleItems","trackImpression","message","context","links","i","link","push","analytics","track","on","throttle","analyticsHooks"],"mappings":"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","file":"/Users/eve/development/force/src/desktop/analytics/article_impressions.js","sourceRoot":"/Users/eve/development/force","sourcesContent":["const $ = require('jquery')\nconst _ = require('underscore')\n\nif (location.pathname.match('/article/') || location.pathname.match('/articles')) {\n  var trackedImpressions = []\n\n  var findVisibleItems = function (articleItems) {\n    if (articleItems.length > 0) {\n      var items = $(articleItems).filter(function () {\n        var viewportTop = $(window).scrollTop()\n        var viewportBottom = viewportTop + $(window).height()\n        var itemTop = $(this).offset().top\n        var itemBottom = itemTop + $(this).outerHeight()\n        // Either item top or item bottom is below the top\n        // of the browser and above the fold.\n        var topInView = itemTop > viewportTop && itemTop < viewportBottom\n        var bottomInView = itemBottom > viewportTop && itemBottom < viewportBottom\n\n        return topInView || bottomInView\n      }).map(function () {\n        var classList = $(this).prop('classList')\n        var articleId = $(this).closest('.article-container').data('id')\n        // Editorial Signup\n        if (classList.contains('articles-es-cta__form')) {\n          if (location.pathname.match('/article/')) {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'article_fixed',\n              article_id: articleId,\n              destination_path: null,\n              id: 'article_fixed'\n            }\n          } else {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'magazine_fixed',\n              destination_path: null,\n              id: 'magazine_fixed'\n            }\n          }\n        } else if (classList.contains('article-es-form')) {\n          if ($(this).parents('.is-expanded')) {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'article_fixed',\n              article_id: articleId,\n              destination_path: null,\n              id: 'article_fixed'\n            }\n          }\n\n        // Social\n        } else if (classList.contains('article-social')) {\n          const article = $(this).closest('.article-content')\n          if ((article.hasClass('gradient-blurb') && article.hasClass('is-expanded')) || !article.hasClass('gradient-blurb')) {\n            return {\n              article_id: articleId,\n              destination_path: null,\n              impression_type: 'social',\n              context_type: 'article_fixed',\n              id: 'social:' + articleId\n            }\n          }\n        } else if (classList.contains('article-share-fixed-fullscreen')) {\n          var indArticleId = $(this).data('id')\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'social',\n            context_type: 'article_fixed',\n            id: 'social:' + indArticleId\n          }\n\n        // Image Set\n        } else if (classList.contains('article-section-image-set')) {\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'image_set',\n            context_type: 'article_fixed',\n            id: 'image_set:' + articleId + ':' + $(this).data('index')\n          }\n\n        // Related Article\n        } else if (classList.contains('article-related-widget')) {\n          var related = $(this).find('a')\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'related_article',\n            context_type: 'article_fixed',\n            id: 'related_articles:' + trackRelatedLinks(related)\n          }\n\n        // Artist Follow\n        } else if (classList.contains('artist-follow')) {\n          const article = $(this).closest('.article-content')\n          if ((article.hasClass('gradient-blurb') && article.hasClass('is-expanded')) || !article.hasClass('gradient-blurb')) {\n            if ($(this).parent('.image-set-modal__container').length > 0) {\n              return {\n                article_id: articleId,\n                destination_path: null,\n                impression_type: 'artist_follow',\n                context_type: 'article_fixed',\n                context_module: 'article_image_set',\n                id: 'artist_follow:' + 'image set' + ':' + $(this).data('id')\n              }\n            } else {\n              return {\n                article_id: articleId,\n                destination_path: null,\n                impression_type: 'artist_follow',\n                context_type: 'article_fixed',\n                context_module: 'article_artist_follow',\n                id: 'artist_follow:' + articleId + ':' + $(this).data('id')\n              }\n            }\n          }\n        } else if (classList.contains('article-section-callout') && $(this)[0].href) {\n          var destinationPath = $(this)[0].href.replace(/^.*\\/\\/[^\\/]+/, '')\n          return {\n            article_id: articleId,\n            destination_path: destinationPath,\n            impression_type: 'article_callout',\n            context_type: 'article_fixed',\n            id: 'article_callout:' + articleId + ':' + destinationPath\n          }\n        } else {\n          \n        }\n      }).toArray()\n\n      // Don't double track the same impressions\n      items = _.filter(items, function (item) {\n        return !(_.contains(trackedImpressions, item.id))\n      })\n      trackedImpressions = trackedImpressions.concat(_.pluck(items, 'id'))\n      // Return only the new impressions\n      return items\n    } else {\n      return []\n    }\n  }\n\n  var trackImpressions = function () {\n    var itemSelectors = '.articles-es-cta__form, .article-es-form,' +\n                        '.article-social, .article-share-fixed-fullscreen,' +\n                        '.article-section-image-set,' +\n                        '.article-section-toc, .article-sa-sticky-header.visible,' +\n                        '.article-sa-related,' +\n                        '.artist-follow,' +\n                        '.article-section-callout,' +\n                        '.article-related-widget'\n\n    var items = $(itemSelectors)\n    var visibleItems = findVisibleItems(items)\n    if (visibleItems.length > 0) {\n      visibleItems.map(function (item) {\n        trackImpression({ message: 'Article Impression', context: item })\n      })\n    }\n  }\n  var trackRelatedLinks = function (related) {\n    var links = []\n    related.map(function (i, link) {\n      links.push(link.href.replace(/^.*\\/\\/[^\\/]+/, ''))\n    })\n    return links\n  }\n\n  var trackImpression = function (item) {\n    analytics.track(item.message, item.context)\n  }\n\n  $(window).on('scroll', _.throttle(trackImpressions, 500))\n\n  analyticsHooks.on('view:image-set-item', function () {\n    trackImpressions()\n  })\n}\n"]}]}