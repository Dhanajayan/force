{"remainingRequest":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/eve/development/force/src/desktop/apps/articles/components/InfiniteScrollNewsArticles.tsx","dependencies":[{"path":"/Users/eve/development/force/src/desktop/apps/articles/components/InfiniteScrollNewsArticles.tsx","mtime":1522254446000},{"path":"/Users/eve/development/force/.babelrc","mtime":1521841348000},{"path":"/Users/eve/development/force/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InfiniteScrollNewsArticles = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _getPrototypeOf = _interopRequireDefault(require(\"@babel/runtime/core-js/object/get-prototype-of\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _Publishing = require(\"@artsy/reaction/dist/Components/Publishing\");\n\nvar _NewsNav = require(\"@artsy/reaction/dist/Components/Publishing/Nav/NewsNav\");\n\nvar _NewsDateDivider = require(\"@artsy/reaction/dist/Components/Publishing/News/NewsDateDivider\");\n\nvar _reactWaypoint = _interopRequireDefault(require(\"react-waypoint\"));\n\nvar _positronql2 = require(\"../../../lib/positronql\");\n\nvar _news_articles_query = require(\"../queries/news_articles_query\");\n\nvar _FollowButton = require(\"../../article/components/FollowButton.js\");\n\nvar _InfiniteScrollArticle = require(\"../../article/components/InfiniteScrollArticle\");\n\n(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\n// FIXME: Rewire\nvar positronql = _positronql2.positronql;\nvar FETCH_TOP_OFFSET = 200;\n\nvar InfiniteScrollNewsArticles =\n/*#__PURE__*/\nfunction (_Component) {\n  (0, _inherits2.default)(InfiniteScrollNewsArticles, _Component);\n\n  function InfiniteScrollNewsArticles(props) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, InfiniteScrollNewsArticles);\n    _this = (0, _possibleConstructorReturn2.default)(this, (InfiniteScrollNewsArticles.__proto__ || (0, _getPrototypeOf.default)(InfiniteScrollNewsArticles)).call(this, props));\n\n    _initialiseProps.call((0, _assertThisInitialized2.default)(_this));\n\n    var articles = props.articles;\n    var date = articles && articles.length ? articles[0].published_at : null;\n    _this.state = {\n      isLoading: false,\n      articles: props.articles || [],\n      date: date,\n      offset: 6,\n      error: false,\n      following: (0, _FollowButton.setupFollows)() || null,\n      isEnabled: true\n    };\n    return _this;\n  }\n\n  (0, _createClass2.default)(InfiniteScrollNewsArticles, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      (0, _FollowButton.setupFollowButtons)(this.state.following);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var date = this.state.date;\n      return _react.default.createElement(\"div\", {\n        id: \"article-root\"\n      }, _react.default.createElement(_NewsNav.NewsNav, {\n        date: date\n      }), this.renderContent(), this.renderWaypoint());\n    }\n  }, {\n    key: \"__reactstandin__regenerateByEval\",\n    value: function __reactstandin__regenerateByEval(key, code) {\n      this[key] = eval(code);\n    }\n  }]);\n  return InfiniteScrollNewsArticles;\n}(_react.Component);\n\nexports.InfiniteScrollNewsArticles = InfiniteScrollNewsArticles;\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this2 = this;\n\n  Object.defineProperty(this, \"fetchNextArticles\", {\n    configurable: true,\n    enumerable: true,\n    writable: true,\n    value: function () {\n      var _value = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee() {\n        var _this2$state, articles, following, offset, data, newArticles;\n\n        return _regenerator.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this2$state = _this2.state, articles = _this2$state.articles, following = _this2$state.following, offset = _this2$state.offset;\n\n                _this2.setState({\n                  isLoading: true\n                });\n\n                _context.prev = 2;\n                _context.next = 5;\n                return positronql({\n                  query: (0, _news_articles_query.newsArticlesQuery)({\n                    offset: offset,\n                    limit: 6\n                  })\n                });\n\n              case 5:\n                data = _context.sent;\n                newArticles = data.articles;\n\n                if (newArticles.length) {\n                  _this2.setState({\n                    articles: articles.concat(newArticles),\n                    isLoading: false,\n                    offset: offset + 6\n                  });\n\n                  (0, _FollowButton.setupFollowButtons)(following);\n                } else {\n                  _this2.setState({\n                    isEnabled: false,\n                    isLoading: false\n                  });\n                }\n\n                _context.next = 14;\n                break;\n\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](2);\n                console.error('(apps/article/InfiniteScrollNewsArticle) Error fetching next article set: ', _context.t0);\n\n                _this2.setState({\n                  isEnabled: false,\n                  isLoading: false,\n                  error: true\n                });\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[2, 10]]);\n      }));\n\n      return function value() {\n        return _value.apply(this, arguments);\n      };\n    }()\n  });\n  Object.defineProperty(this, \"renderWaypoint\", {\n    configurable: true,\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var _this2$state2 = _this2.state,\n          isEnabled = _this2$state2.isEnabled,\n          isLoading = _this2$state2.isLoading,\n          error = _this2$state2.error;\n\n      if (isEnabled) {\n        if (!isLoading) {\n          return _react.default.createElement(_reactWaypoint.default, {\n            onEnter: _this2.fetchNextArticles,\n            topOffset: FETCH_TOP_OFFSET\n          });\n        } else if (!error) {\n          return _react.default.createElement(_InfiniteScrollArticle.LoadingSpinner, null, _react.default.createElement(\"div\", {\n            className: \"loading-spinner\"\n          }));\n        }\n      }\n    }\n  });\n  Object.defineProperty(this, \"onEnter\", {\n    configurable: true,\n    enumerable: true,\n    writable: true,\n    value: function value(article, _ref) {\n      var previousPosition = _ref.previousPosition,\n          currentPosition = _ref.currentPosition;\n      var date = _this2.state.date;\n      var enteredArticle = previousPosition === 'above' && currentPosition === 'inside';\n      var hasNewDate = article.published_at !== date;\n\n      if (enteredArticle && hasNewDate) {\n        // ENTERED AN ARTICLE\n        _this2.setState({\n          date: article.published_at\n        });\n      }\n    }\n  });\n  Object.defineProperty(this, \"onLeave\", {\n    configurable: true,\n    enumerable: true,\n    writable: true,\n    value: function value(i, _ref2) {\n      var previousPosition = _ref2.previousPosition,\n          currentPosition = _ref2.currentPosition;\n      var nextArticle = _this2.state.articles[i + 1];\n      var date = _this2.state.date;\n      var hasNewDate = nextArticle && nextArticle.published_at !== date;\n\n      if (nextArticle && previousPosition === 'inside' && currentPosition === 'above' && hasNewDate) {\n        // LEFT AN ARTICLE\n        _this2.setState({\n          date: nextArticle.published_at\n        });\n\n        window.history.replaceState({}, 'news', \"/news\");\n      }\n    }\n  });\n  Object.defineProperty(this, \"onExpand\", {\n    configurable: true,\n    enumerable: true,\n    writable: true,\n    value: function value(article) {\n      // Set slug/document title when expanding an article\n      document.title = article.thumbnail_title;\n      window.history.replaceState({}, article.id, \"/news/\".concat(article.slug));\n    }\n  });\n  Object.defineProperty(this, \"renderContent\", {\n    configurable: true,\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var articles = _this2.state.articles;\n      var _this2$props = _this2.props,\n          isMobile = _this2$props.isMobile,\n          marginTop = _this2$props.marginTop;\n      return (0, _lodash.flatten)(articles.map(function (article, i) {\n        var beforeArticle = articles[i - 1];\n        var hasNewDate = beforeArticle && beforeArticle.published_at.substring(0, 10) !== article.published_at.substring(0, 10);\n        return _react.default.createElement(\"div\", {\n          key: \"article-\".concat(i)\n        }, hasNewDate && _react.default.createElement(_NewsDateDivider.NewsDateDivider, {\n          date: article.published_at\n        }), _react.default.createElement(_Publishing.Article, {\n          article: article,\n          isTruncated: true,\n          isMobile: isMobile,\n          marginTop: i === 0 ? marginTop : null,\n          onExpand: function onExpand() {\n            return _this2.onExpand(article);\n          }\n        }), _react.default.createElement(_reactWaypoint.default, {\n          topOffset: FETCH_TOP_OFFSET,\n          onEnter: function onEnter(waypointData) {\n            return _this2.onEnter(article, waypointData);\n          },\n          onLeave: function onLeave(waypointData) {\n            return _this2.onLeave(i, waypointData);\n          }\n        }));\n      }));\n    }\n  });\n};\n\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(positronql, \"positronql\", \"/Users/eve/development/force/src/desktop/apps/articles/components/InfiniteScrollNewsArticles.tsx\");\n  reactHotLoader.register(FETCH_TOP_OFFSET, \"FETCH_TOP_OFFSET\", \"/Users/eve/development/force/src/desktop/apps/articles/components/InfiniteScrollNewsArticles.tsx\");\n  reactHotLoader.register(InfiniteScrollNewsArticles, \"InfiniteScrollNewsArticles\", \"/Users/eve/development/force/src/desktop/apps/articles/components/InfiniteScrollNewsArticles.tsx\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["src/desktop/apps/articles/components/InfiniteScrollNewsArticles.tsx"],"names":["positronql","FETCH_TOP_OFFSET","InfiniteScrollNewsArticles","props","articles","date","length","published_at","state","isLoading","offset","error","following","isEnabled","renderContent","renderWaypoint","setState","query","limit","data","newArticles","concat","console","fetchNextArticles","article","previousPosition","currentPosition","enteredArticle","hasNewDate","i","nextArticle","window","history","replaceState","document","title","thumbnail_title","id","slug","isMobile","marginTop","map","beforeArticle","substring","onExpand","waypointData","onEnter","onLeave"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;;;;;;;AAkBA;AACA,IAAIA,oCAAJ;AAEA,IAAMC,mBAAmB,GAAzB;;IAEaC,0B;;;;;AAKX,sCAAYC,KAAZ,EAAmB;AAAA;;AAAA;AACjB,yKAAMA,KAAN;;AADiB;;AAAA,QAGTC,QAHS,GAGID,KAHJ,CAGTC,QAHS;AAIjB,QAAMC,OAAOD,YAAYA,SAASE,MAArB,GAA8BF,SAAS,CAAT,EAAYG,YAA1C,GAAyD,IAAtE;AAEA,UAAKC,KAAL,GAAa;AACXC,iBAAW,KADA;AAEXL,gBAAUD,MAAMC,QAAN,IAAkB,EAFjB;AAGXC,gBAHW;AAIXK,cAAQ,CAJG;AAKXC,aAAO,KALI;AAMXC,iBAAW,qCAAkB,IANlB;AAOXC,iBAAW;AAPA,KAAb;AANiB;AAelB;;;;wCAEmB;AAClB,4CAAmB,KAAKL,KAAL,CAAWI,SAA9B;AACD;;;6BAoIQ;AAAA,UACCP,IADD,GACU,KAAKG,KADf,CACCH,IADD;AAGP,aACE;AAAK,YAAG;AAAR,SACE;AAAS,cAAMA;AAAf,QADF,EAEG,KAAKS,aAAL,EAFH,EAGG,KAAKC,cAAL,EAHH,CADF;AAOD;;;;;;;;;;;;;;;;;;;;;;gCA5ImB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,+BACsB,OAAKP,KAD3B,EACVJ,QADU,gBACVA,QADU,EACAQ,SADA,gBACAA,SADA,EACWF,MADX,gBACWA,MADX;;AAGlB,uBAAKM,QAAL,CAAc;AACZP,6BAAW;AADC,iBAAd;;AAHkB;AAAA;AAAA,uBAQGT,WAAW;AAC5BiB,yBAAO,4CAAkB;AACvBP,kCADuB;AAEvBQ,2BAAO;AAFgB,mBAAlB;AADqB,iBAAX,CARH;;AAAA;AAQVC,oBARU;AAeVC,2BAfU,GAeID,KAAKf,QAfT;;AAiBhB,oBAAIgB,YAAYd,MAAhB,EAAwB;AACtB,yBAAKU,QAAL,CAAc;AACZZ,8BAAUA,SAASiB,MAAT,CAAgBD,WAAhB,CADE;AAEZX,+BAAW,KAFC;AAGZC,4BAAQA,SAAS;AAHL,mBAAd;;AAKA,wDAAmBE,SAAnB;AACD,iBAPD,MAOO;AACL,yBAAKI,QAAL,CAAc;AACZH,+BAAW,KADC;AAEZJ,+BAAW;AAFC,mBAAd;AAID;;AA7Be;AAAA;;AAAA;AAAA;AAAA;AA+BhBa,wBAAQX,KAAR,CACE,4EADF;;AAKA,uBAAKK,QAAL,CAAc;AACZH,6BAAW,KADC;AAEZJ,6BAAW,KAFC;AAGZE,yBAAO;AAHK,iBAAd;;AApCgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;WA4CH,iBAAM;AAAA,0BACmB,OAAKH,KADxB;AAAA,UACbK,SADa,iBACbA,SADa;AAAA,UACFJ,SADE,iBACFA,SADE;AAAA,UACSE,KADT,iBACSA,KADT;;AAGrB,UAAIE,SAAJ,EAAe;AACb,YAAI,CAACJ,SAAL,EAAgB;AACd,iBACE;AACE,qBAAS,OAAKc,iBADhB;AAEE,uBAAWtB;AAFb,YADF;AAMD,SAPD,MAOO,IAAI,CAACU,KAAL,EAAY;AACjB,iBACE,0EACE;AAAK,uBAAU;AAAf,YADF,CADF;AAKD;AACF;AACF;;;;;;WAES,eAACa,OAAD,QAAoD;AAAA,UAAxCC,gBAAwC,QAAxCA,gBAAwC;AAAA,UAAtBC,eAAsB,QAAtBA,eAAsB;AAAA,UACpDrB,IADoD,GAC3C,OAAKG,KADsC,CACpDH,IADoD;AAE5D,UAAMsB,iBACJF,qBAAqB,OAArB,IAAgCC,oBAAoB,QADtD;AAEA,UAAME,aAAaJ,QAAQjB,YAAR,KAAyBF,IAA5C;;AAEA,UAAIsB,kBAAkBC,UAAtB,EAAkC;AAChC;AACA,eAAKZ,QAAL,CAAc;AAAEX,gBAAMmB,QAAQjB;AAAhB,SAAd;AACD;AACF;;;;;;WAES,eAACsB,CAAD,SAA8C;AAAA,UAAxCJ,gBAAwC,SAAxCA,gBAAwC;AAAA,UAAtBC,eAAsB,SAAtBA,eAAsB;AACtD,UAAMI,cAAc,OAAKtB,KAAL,CAAWJ,QAAX,CAAoByB,IAAI,CAAxB,CAApB;AADsD,UAE9CxB,IAF8C,GAErC,OAAKG,KAFgC,CAE9CH,IAF8C;AAGtD,UAAMuB,aAAaE,eAAeA,YAAYvB,YAAZ,KAA6BF,IAA/D;;AACA,UACEyB,eACAL,qBAAqB,QADrB,IAEAC,oBAAoB,OAFpB,IAGAE,UAJF,EAKE;AACA;AACA,eAAKZ,QAAL,CAAc;AAAEX,gBAAMyB,YAAYvB;AAApB,SAAd;;AACAwB,eAAOC,OAAP,CAAeC,YAAf,CAA4B,EAA5B,EAAgC,MAAhC;AACD;AACF;;;;;;WAEU,eAACT,OAAD,EAAa;AACtB;AACAU,eAASC,KAAT,GAAiBX,QAAQY,eAAzB;AACAL,aAAOC,OAAP,CAAeC,YAAf,CAA4B,EAA5B,EAAgCT,QAAQa,EAAxC,kBAAqDb,QAAQc,IAA7D;AACD;;;;;;WAEe,iBAAM;AAAA,UACZlC,QADY,GACC,OAAKI,KADN,CACZJ,QADY;AAAA,yBAEY,OAAKD,KAFjB;AAAA,UAEZoC,QAFY,gBAEZA,QAFY;AAAA,UAEFC,SAFE,gBAEFA,SAFE;AAIpB,aAAO,qBACLpC,SAASqC,GAAT,CAAa,UAACjB,OAAD,EAAUK,CAAV,EAAgB;AAC3B,YAAMa,gBAAgBtC,SAASyB,IAAI,CAAb,CAAtB;AACA,YAAMD,aAAac,iBACjBA,cAAcnC,YAAd,CAA2BoC,SAA3B,CAAqC,CAArC,EAAwC,EAAxC,MAAgDnB,QAAQjB,YAAR,CAAqBoC,SAArB,CAA+B,CAA/B,EAAkC,EAAlC,CADlD;AAGA,eACE;AAAK,iCAAgBd,CAAhB;AAAL,WACGD,cAAc;AAAiB,gBAAMJ,QAAQjB;AAA/B,UADjB,EAEE;AACE,mBAASiB,OADX;AAEE,uBAAa,IAFf;AAGE,oBAAUe,QAHZ;AAIE,qBAAWV,MAAM,CAAN,GAAUW,SAAV,GAAsB,IAJnC;AAKE,oBAAU;AAAA,mBAAM,OAAKI,QAAL,CAAcpB,OAAd,CAAN;AAAA;AALZ,UAFF,EASE;AACE,qBAAWvB,gBADb;AAEE,mBAAS,iBAAC4C,YAAD;AAAA,mBAAkB,OAAKC,OAAL,CAAatB,OAAb,EAAsBqB,YAAtB,CAAlB;AAAA,WAFX;AAGE,mBAAS,iBAACA,YAAD;AAAA,mBAAkB,OAAKE,OAAL,CAAalB,CAAb,EAAgBgB,YAAhB,CAAlB;AAAA;AAHX,UATF,CADF;AAiBD,OAtBD,CADK,CAAP;AAyBD;;;;;;;;;;;;;;;0BA9JC7C,U;0BAEEC,gB;0BAEOC,0B","file":"/Users/eve/development/force/src/desktop/apps/articles/components/InfiniteScrollNewsArticles.tsx","sourceRoot":"/Users/eve/development/force","sourcesContent":["import React, { Component } from 'react'\nimport { flatten } from 'lodash'\nimport { Article } from '@artsy/reaction/dist/Components/Publishing'\nimport { NewsNav } from '@artsy/reaction/dist/Components/Publishing/Nav/NewsNav'\nimport { NewsDateDivider } from '@artsy/reaction/dist/Components/Publishing/News/NewsDateDivider'\nimport { ArticleData } from '@artsy/reaction/dist/Components/Publishing/Typings'\nimport Waypoint from 'react-waypoint'\nimport { positronql as _positronql } from 'desktop/lib/positronql'\nimport { newsArticlesQuery } from '../queries/news_articles_query'\nimport { setupFollows, setupFollowButtons } from 'desktop/apps/article/components/FollowButton.js'\nimport { LoadingSpinner } from 'desktop/apps/article/components/InfiniteScrollArticle'\n\nexport interface Props {\n  articles: ArticleData[]\n  isMobile: boolean\n  marginTop: string\n}\n\ninterface State {\n  isLoading: boolean\n  articles: ArticleData[]\n  date: any\n  offset: number\n  error: boolean\n  following: any[]\n  isEnabled: boolean\n}\n\n// FIXME: Rewire\nlet positronql = _positronql\n\nconst FETCH_TOP_OFFSET = 200\n\nexport class InfiniteScrollNewsArticles extends Component<\n  Props,\n  State\n  > {\n\n  constructor(props) {\n    super(props)\n\n    const { articles } = props\n    const date = articles && articles.length ? articles[0].published_at : null\n\n    this.state = {\n      isLoading: false,\n      articles: props.articles || [],\n      date,\n      offset: 6,\n      error: false,\n      following: setupFollows() || null,\n      isEnabled: true,\n    }\n  }\n\n  componentDidMount() {\n    setupFollowButtons(this.state.following)\n  }\n\n  fetchNextArticles = async () => {\n    const { articles, following, offset } = this.state\n\n    this.setState({\n      isLoading: true,\n    })\n\n    try {\n      const data = await positronql({\n        query: newsArticlesQuery({\n          offset,\n          limit: 6\n        }),\n      })\n\n      const newArticles = data.articles\n\n      if (newArticles.length) {\n        this.setState({\n          articles: articles.concat(newArticles),\n          isLoading: false,\n          offset: offset + 6,\n        })\n        setupFollowButtons(following)\n      } else {\n        this.setState({\n          isEnabled: false,\n          isLoading: false,\n        })\n      }\n    } catch (error) {\n      console.error(\n        '(apps/article/InfiniteScrollNewsArticle) Error fetching next article set: ',\n        error\n      )\n\n      this.setState({\n        isEnabled: false,\n        isLoading: false,\n        error: true,\n      })\n    }\n  }\n\n  renderWaypoint = () => {\n    const { isEnabled, isLoading, error } = this.state\n\n    if (isEnabled) {\n      if (!isLoading) {\n        return (\n          <Waypoint\n            onEnter={this.fetchNextArticles}\n            topOffset={FETCH_TOP_OFFSET}\n          />\n        )\n      } else if (!error) {\n        return (\n          <LoadingSpinner>\n            <div className=\"loading-spinner\" />\n          </LoadingSpinner>\n        )\n      }\n    }\n  }\n\n  onEnter = (article, { previousPosition, currentPosition }) => {\n    const { date } = this.state\n    const enteredArticle =\n      previousPosition === 'above' && currentPosition === 'inside'\n    const hasNewDate = article.published_at !== date\n\n    if (enteredArticle && hasNewDate) {\n      // ENTERED AN ARTICLE\n      this.setState({ date: article.published_at })\n    }\n  }\n\n  onLeave = (i, { previousPosition, currentPosition }) => {\n    const nextArticle = this.state.articles[i + 1]\n    const { date } = this.state\n    const hasNewDate = nextArticle && nextArticle.published_at !== date\n    if (\n      nextArticle &&\n      previousPosition === 'inside' &&\n      currentPosition === 'above' &&\n      hasNewDate\n    ) {\n      // LEFT AN ARTICLE\n      this.setState({ date: nextArticle.published_at })\n      window.history.replaceState({}, 'news', `/news`)\n    }\n  }\n\n  onExpand = (article) => {\n    // Set slug/document title when expanding an article\n    document.title = article.thumbnail_title\n    window.history.replaceState({}, article.id, `/news/${article.slug}`)\n  }\n\n  renderContent = () => {\n    const { articles } = this.state\n    const { isMobile, marginTop } = this.props\n\n    return flatten(\n      articles.map((article, i) => {\n        const beforeArticle = articles[i - 1]\n        const hasNewDate = beforeArticle &&\n          beforeArticle.published_at.substring(0, 10) !== article.published_at.substring(0, 10)\n\n        return (\n          <div key={`article-${i}`}>\n            {hasNewDate && <NewsDateDivider date={article.published_at} />}\n            <Article\n              article={article}\n              isTruncated={true}\n              isMobile={isMobile}\n              marginTop={i === 0 ? marginTop : null}\n              onExpand={() => this.onExpand(article)}\n            />\n            <Waypoint\n              topOffset={FETCH_TOP_OFFSET}\n              onEnter={(waypointData) => this.onEnter(article, waypointData)}\n              onLeave={(waypointData) => this.onLeave(i, waypointData)}\n            />\n          </div>\n        )\n      })\n    )\n  }\n\n  render() {\n    const { date } = this.state\n\n    return (\n      <div id=\"article-root\">\n        <NewsNav date={date} />\n        {this.renderContent()}\n        {this.renderWaypoint()}\n      </div>\n    )\n  }\n}\n"]}]}