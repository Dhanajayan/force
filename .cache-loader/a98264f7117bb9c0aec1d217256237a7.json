{"remainingRequest":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/eve/development/force/src/desktop/analytics/account_creation.js","dependencies":[{"path":"/Users/eve/development/force/src/desktop/analytics/account_creation.js","mtime":1531409003000},{"path":"/Users/eve/development/force/.babelrc","mtime":1537178749000},{"path":"/Users/eve/development/force/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"@babel/runtime/helpers/objectSpread\";\n\n(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nimport mediator from \"../lib/mediator.coffee\"; //\n// Generic events for tracking events around account creation.\n//\n\nvar getUrlParameter = function getUrlParameter(name) {\n  name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n  var regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\n  var results = regex.exec(location.search);\n  return results === null ? undefined : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n};\n\nvar getAcquisitionInitiative = function getAcquisitionInitiative() {\n  return getUrlParameter('m-id') || getUrlParameter('acquisition_initiative');\n};\n\nvar trackAccountCreation = function trackAccountCreation(options) {\n  analytics.track('Created account', options);\n  analytics.identify(options.user_id, _.pick(options, 'email'), {\n    integrations: {\n      All: false,\n      Marketo: true\n    }\n  });\n}; // Created account (via email)\n\n\n$(document).one('submit', '.auth-register form, .marketing-signup-modal form, .artist-page-cta-overlay__register form, .gdpr-signup form', function () {\n  $(document).one('ajaxComplete', function (e, xhr, options) {\n    return mediator.trigger('auth:sign_up:email', {\n      acquisition_initiative: getAcquisitionInitiative(),\n      signup_service: 'email',\n      user_id: xhr.responseJSON.user.id,\n      context: options.context,\n      email: xhr.responseJSON.user.email\n    });\n  });\n}); // Created account (via social)\n// 1. Upon clicking the social signup button\n\n$(document).on('click', '.auth-signup-facebook, .gdpr-signup__fb', function (e) {\n  // 2. Store some data in cookies before being redirected everywhere\n  mediator.trigger('auth:sign_up:fb', {\n    service: 'facebook',\n    acquisition_initiative: getAcquisitionInitiative(),\n    context: $(e.currentTarget).data('context')\n  });\n}); // 3. After landing back on Artsy send the tracking call and expire the cookie\n\nif (Cookies.get('analytics-signup')) {\n  var data = JSON.parse(Cookies.get('analytics-signup'));\n  Cookies.expire('analytics-signup');\n\n  if (sd.CURRENT_USER) {\n    trackAccountCreation(_objectSpread({}, data, {\n      user_id: sd.CURRENT_USER.id\n    }));\n  }\n\n  analyticsHooks.on('auth:login', function () {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    analytics.track('Successfully logged in', options);\n  }); // Triggered sign up form via save button\n\n  if (!sd.CURRENT_USER) {\n    $('.artwork-item-image-container .overlay-button-save').click(function () {\n      analytics.track('Triggered sign up form via save button');\n    });\n  } // Triggered sign up form via follow button\n\n\n  if (!sd.CURRENT_USER) {\n    $('.follow-button, .entity-follow').click(function () {\n      analytics.track('Triggered sign up form via follow button');\n    });\n  } // Clicked sign up via the header\n\n\n  $('.mlh-signup').click(function () {\n    analytics.track('Clicked sign up via the header');\n  }); // Clicked sign out via the header\n\n  $('.mlh-logout').click(function () {\n    analytics.track('Clicked logout via the header');\n  }); // Viewed sign up options\n\n  var trackViewSignup = function trackViewSignup() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    analytics.track('Viewed sign up options', options);\n  };\n\n  analyticsHooks.on('mediator:open:auth', function () {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (options.mode === 'signup') trackViewSignup(options);\n    analytics.trackLink($('.auth-signup-facebook')[0], 'Created account');\n    analytics.trackLink($('.auth-signup-twitter')[0], 'Created account');\n  });\n  $('#auth-footer [href*=sign_up]').click(trackViewSignup); // Created account via consignments submission page\n\n  analyticsHooks.on('consignment:account:created', function (options) {\n    if (options.accountCreated) {\n      trackAccountCreation({\n        signup_service: 'email',\n        user_id: options.id,\n        context: 'consignments',\n        email: options.email\n      });\n    } else {\n      analytics.identify(options.user_id, options.email, {\n        integrations: {\n          All: false,\n          Marketo: true\n        }\n      });\n    }\n  });\n}\n\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(getUrlParameter, \"getUrlParameter\", \"/Users/eve/development/force/src/desktop/analytics/account_creation.js\");\n  reactHotLoader.register(getAcquisitionInitiative, \"getAcquisitionInitiative\", \"/Users/eve/development/force/src/desktop/analytics/account_creation.js\");\n  reactHotLoader.register(trackAccountCreation, \"trackAccountCreation\", \"/Users/eve/development/force/src/desktop/analytics/account_creation.js\");\n  reactHotLoader.register(data, \"data\", \"/Users/eve/development/force/src/desktop/analytics/account_creation.js\");\n  reactHotLoader.register(trackViewSignup, \"trackViewSignup\", \"/Users/eve/development/force/src/desktop/analytics/account_creation.js\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["/Users/eve/development/force/src/desktop/analytics/account_creation.js"],"names":["mediator","getUrlParameter","name","replace","regex","RegExp","results","exec","location","search","undefined","decodeURIComponent","getAcquisitionInitiative","trackAccountCreation","options","analytics","track","identify","user_id","_","pick","integrations","All","Marketo","$","document","one","e","xhr","trigger","acquisition_initiative","signup_service","responseJSON","user","id","context","email","on","service","currentTarget","data","Cookies","get","JSON","parse","expire","sd","CURRENT_USER","analyticsHooks","click","trackViewSignup","mode","trackLink","accountCreated"],"mappings":"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","sourcesContent":["import mediator from '../lib/mediator.coffee'\n//\n// Generic events for tracking events around account creation.\n//\n\nconst getUrlParameter = name => {\n  name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]')\n  let regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)')\n  let results = regex.exec(location.search)\n  return results === null\n    ? undefined\n    : decodeURIComponent(results[1].replace(/\\+/g, ' '))\n}\n\nconst getAcquisitionInitiative = () =>\n  getUrlParameter('m-id') || getUrlParameter('acquisition_initiative')\n\nconst trackAccountCreation = options => {\n  analytics.track('Created account', options)\n\n  analytics.identify(options.user_id, _.pick(options, 'email'), {\n    integrations: {\n      All: false,\n      Marketo: true,\n    },\n  })\n}\n\n// Created account (via email)\n$(document).one(\n  'submit',\n  '.auth-register form, .marketing-signup-modal form, .artist-page-cta-overlay__register form, .gdpr-signup form',\n  () => {\n    $(document).one('ajaxComplete', (e, xhr, options) =>\n      mediator.trigger('auth:sign_up:email', {\n        acquisition_initiative: getAcquisitionInitiative(),\n        signup_service: 'email',\n        user_id: xhr.responseJSON.user.id,\n        context: options.context,\n        email: xhr.responseJSON.user.email,\n      })\n    )\n  }\n)\n\n// Created account (via social)\n\n// 1. Upon clicking the social signup button\n$(document).on('click', '.auth-signup-facebook, .gdpr-signup__fb', e => {\n  // 2. Store some data in cookies before being redirected everywhere\n  mediator.trigger('auth:sign_up:fb', {\n    service: 'facebook',\n    acquisition_initiative: getAcquisitionInitiative(),\n    context: $(e.currentTarget).data('context'),\n  })\n})\n\n// 3. After landing back on Artsy send the tracking call and expire the cookie\nif (Cookies.get('analytics-signup')) {\n  var data = JSON.parse(Cookies.get('analytics-signup'))\n  Cookies.expire('analytics-signup')\n\n  if (sd.CURRENT_USER) {\n    trackAccountCreation({\n      ...data,\n      user_id: sd.CURRENT_USER.id,\n    })\n  }\n\n  analyticsHooks.on('auth:login', (options = {}) => {\n    analytics.track('Successfully logged in', options)\n  })\n\n  // Triggered sign up form via save button\n  if (!sd.CURRENT_USER) {\n    $('.artwork-item-image-container .overlay-button-save').click(function() {\n      analytics.track('Triggered sign up form via save button')\n    })\n  }\n\n  // Triggered sign up form via follow button\n  if (!sd.CURRENT_USER) {\n    $('.follow-button, .entity-follow').click(function() {\n      analytics.track('Triggered sign up form via follow button')\n    })\n  }\n\n  // Clicked sign up via the header\n  $('.mlh-signup').click(function() {\n    analytics.track('Clicked sign up via the header')\n  })\n\n  // Clicked sign out via the header\n  $('.mlh-logout').click(function() {\n    analytics.track('Clicked logout via the header')\n  })\n\n  // Viewed sign up options\n  var trackViewSignup = (options = {}) => {\n    analytics.track('Viewed sign up options', options)\n  }\n\n  analyticsHooks.on('mediator:open:auth', (options = {}) => {\n    if (options.mode === 'signup') trackViewSignup(options)\n\n    analytics.trackLink($('.auth-signup-facebook')[0], 'Created account')\n    analytics.trackLink($('.auth-signup-twitter')[0], 'Created account')\n  })\n\n  $('#auth-footer [href*=sign_up]').click(trackViewSignup)\n\n  // Created account via consignments submission page\n  analyticsHooks.on('consignment:account:created', function(options) {\n    if (options.accountCreated) {\n      trackAccountCreation({\n        signup_service: 'email',\n        user_id: options.id,\n        context: 'consignments',\n        email: options.email,\n      })\n    } else {\n      analytics.identify(options.user_id, options.email, {\n        integrations: {\n          All: false,\n          Marketo: true,\n        },\n      })\n    }\n  })\n}\n"]}]}