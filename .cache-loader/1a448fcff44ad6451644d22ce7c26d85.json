{"remainingRequest":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/eve/development/force/src/desktop/apps/article/client/classic.js","dependencies":[{"path":"/Users/eve/development/force/src/desktop/apps/article/client/classic.js","mtime":1521064653000},{"path":"/Users/eve/development/force/.babelrc","mtime":1528124541000},{"path":"/Users/eve/development/force/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.init = void 0;\n\nvar _jquery = _interopRequireDefault(require(\"jquery\"));\n\nvar _sharify = require(\"sharify\");\n\nvar _promotedContent = require(\"../queries/promotedContent\");\n\nvar _metaphysics = _interopRequireDefault(require(\"../../../../lib/metaphysics.coffee\"));\n\nvar _article = _interopRequireDefault(require(\"../../../models/article.coffee\"));\n\nvar _articles = _interopRequireDefault(require(\"../../../collections/articles.coffee\"));\n\nvar _view = _interopRequireDefault(require(\"../../../components/articles_grid/view.coffee\"));\n\nvar _view2 = _interopRequireDefault(require(\"../../../components/article/client/view.coffee\"));\n\nvar _channel = _interopRequireDefault(require(\"../../../models/channel.coffee\"));\n\nvar _gallery_insights = _interopRequireDefault(require(\"../../../components/email/client/gallery_insights.coffee\"));\n\nvar _view3 = _interopRequireDefault(require(\"../../../components/channel_nav/view.coffee\"));\n\n// Initializes all client-side Backbone views for \"classic\" layouts\n// FIXME: Rewire\nvar $ = _jquery.default;\nvar sd = _sharify.data;\nvar ArticlesGridView = _view.default;\nvar TeamChannelNavView = _view3.default;\nvar ArticleView = _view2.default;\nvar GalleryInsightsView = _gallery_insights.default;\n\nvar promotedTemplate = function promotedTemplate(args) {\n  return require(\"../templates/promoted_content.jade\")(args);\n};\n\nvar init = function init() {\n  var article = new _article.default(sd.ARTICLE);\n  var channel = new _channel.default(sd.ARTICLE_CHANNEL);\n  new ArticleView({\n    el: $('body'),\n    article: article\n  });\n  new GalleryInsightsView({\n    el: $('body')\n  });\n\n  if (channel.isTeam()) {\n    new TeamChannelNavView({\n      el: $('body'),\n      $content: $('.article-content'),\n      offset: 0\n    });\n  }\n\n  setupFooterArticles(channel);\n  setupPromotedContent(article);\n};\n\nexports.init = init;\n\nvar setupFooterArticles = function setupFooterArticles(channel) {\n  var data = {\n    published: true,\n    sort: '-published_at',\n    limit: 12,\n    channel_id: channel.get('id')\n  };\n  var collection = new _articles.default();\n  new ArticlesGridView({\n    el: $('#articles-footer').addClass('articles-grid'),\n    hideMore: true,\n    header: \"More from \".concat(channel.get('name') || 'Artsy'),\n    collection: collection\n  });\n  collection.fetch({\n    data: data\n  });\n};\n\nvar setupPromotedContent = function setupPromotedContent(article) {\n  var channel = article.get('channel_id');\n\n  if (channel === sd.PC_ARTSY_CHANNEL && article.get('partner_ids')) {\n    var send = {\n      method: 'post',\n      query: (0, _promotedContent.partnerQuery)(article.get('partner_ids')[0])\n    };\n    (0, _metaphysics.default)(send).then(function (data) {\n      var cropped = data.partner.profile.image.cropped;\n      var src = cropped ? cropped.url : '';\n      $('#articles-show').prepend(promotedTemplate({\n        src: src,\n        name: data.partner.name,\n        href: data.partner.profile.href,\n        type: data.partner.type === 'Gallery' ? 'Gallery' : 'Institution'\n      }));\n    });\n  } else if (channel === sd.PC_AUCTION_CHANNEL && article.get('auction_ids')) {\n    var _send = {\n      method: 'post',\n      query: (0, _promotedContent.auctionQuery)(article.get('auction_ids')[0])\n    };\n    (0, _metaphysics.default)(_send).then(function (data) {\n      var cropped = data.sale.cover_image.cropped;\n      var src = cropped ? cropped.url : '';\n      $('#articles-show').prepend(promotedTemplate({\n        src: src,\n        name: data.sale.name,\n        href: data.sale.href,\n        type: 'Auction'\n      }));\n    });\n  }\n};",{"version":3,"sources":["src/desktop/apps/article/client/classic.js"],"names":["$","sd","ArticlesGridView","TeamChannelNavView","ArticleView","GalleryInsightsView","promotedTemplate","args","require","init","article","ARTICLE","channel","ARTICLE_CHANNEL","el","isTeam","$content","offset","setupFooterArticles","setupPromotedContent","data","published","sort","limit","channel_id","get","collection","addClass","hideMore","header","fetch","PC_ARTSY_CHANNEL","send","method","query","then","cropped","partner","profile","image","src","url","prepend","name","href","type","PC_AUCTION_CHANNEL","sale","cover_image"],"mappings":"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","file":"/Users/eve/development/force/src/desktop/apps/article/client/classic.js","sourceRoot":"/Users/eve/development/force","sourcesContent":["// Initializes all client-side Backbone views for \"classic\" layouts\n\nimport _$ from 'jquery'\nimport { data as _sd } from 'sharify'\nimport { auctionQuery, partnerQuery } from 'desktop/apps/article/queries/promotedContent'\nimport metaphysics from 'lib/metaphysics.coffee'\nimport Article from 'desktop/models/article.coffee'\nimport Articles from 'desktop/collections/articles.coffee'\nimport _ArticlesGridView from 'desktop/components/articles_grid/view.coffee'\nimport _ArticleView from 'desktop/components/article/client/view.coffee'\nimport Channel from 'desktop/models/channel.coffee'\nimport _GalleryInsightsView from 'desktop/components/email/client/gallery_insights.coffee'\nimport _TeamChannelNavView from 'desktop/components/channel_nav/view.coffee'\n\n// FIXME: Rewire\nlet $ = _$\nlet sd = _sd\nlet ArticlesGridView = _ArticlesGridView\nlet TeamChannelNavView = _TeamChannelNavView\nlet ArticleView = _ArticleView\nlet GalleryInsightsView = _GalleryInsightsView\n\nconst promotedTemplate = (args) => {\n  return require('desktop/apps/article/templates/promoted_content.jade')(args)\n}\n\nexport const init = () => {\n  const article = new Article(sd.ARTICLE)\n  const channel = new Channel(sd.ARTICLE_CHANNEL)\n\n  new ArticleView({\n    el: $('body'),\n    article\n  })\n\n  new GalleryInsightsView({ el: $('body') })\n\n  if (channel.isTeam()) {\n    new TeamChannelNavView({\n      el: $('body'),\n      $content: $('.article-content'),\n      offset: 0\n    })\n  }\n\n  setupFooterArticles(channel)\n  setupPromotedContent(article)\n}\n\nconst setupFooterArticles = (channel) => {\n  const data = {\n    published: true,\n    sort: '-published_at',\n    limit: 12,\n    channel_id: channel.get('id')\n  }\n  const collection = new Articles()\n\n  new ArticlesGridView({\n    el: $('#articles-footer').addClass('articles-grid'),\n    hideMore: true,\n    header: `More from ${channel.get('name') || 'Artsy'}`,\n    collection\n  })\n\n  collection.fetch({\n    data: data\n  })\n}\n\nconst setupPromotedContent = (article) => {\n  const channel = article.get('channel_id')\n  if (channel === sd.PC_ARTSY_CHANNEL && article.get('partner_ids')) {\n    const send = {\n      method: 'post',\n      query: partnerQuery(article.get('partner_ids')[0])\n    }\n    metaphysics(send)\n    .then((data) => {\n      const cropped = data.partner.profile.image.cropped\n      const src = cropped ? cropped.url : ''\n      $('#articles-show').prepend(promotedTemplate({\n        src,\n        name: data.partner.name,\n        href: data.partner.profile.href,\n        type: data.partner.type === 'Gallery' ? 'Gallery' : 'Institution'\n      }))\n    })\n  } else if (channel === sd.PC_AUCTION_CHANNEL && article.get('auction_ids')) {\n    const send = {\n      method: 'post',\n      query: auctionQuery(article.get('auction_ids')[0])\n    }\n    metaphysics(send)\n    .then((data) => {\n      const cropped = data.sale.cover_image.cropped\n      const src = cropped ? cropped.url : ''\n      $('#articles-show').prepend(promotedTemplate({\n        src,\n        name: data.sale.name,\n        href: data.sale.href,\n        type: 'Auction'\n      }))\n    })\n  }\n}\n"]}]}