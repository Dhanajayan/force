{"remainingRequest":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/eve/development/force/src/desktop/apps/auction/utils/analyticsMiddleware.js","dependencies":[{"path":"/Users/eve/development/force/src/desktop/apps/auction/utils/analyticsMiddleware.js","mtime":1521064653000},{"path":"/Users/eve/development/force/.babelrc","mtime":1528124541000},{"path":"/Users/eve/development/force/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar actions = _interopRequireWildcard(require(\"../actions/artworkBrowser\"));\n\nvar _analytics_hooks = _interopRequireDefault(require(\"../../../lib/analytics_hooks.coffee\"));\n\nvar _underscore = require(\"underscore\");\n\n// FIXME: Rewire\nvar analyticsHooks = _analytics_hooks.default;\n\nvar analyticsMiddleware = function analyticsMiddleware(store) {\n  return function (next) {\n    return function (action) {\n      var result = next(action);\n      var nextState = store.getState(); // track certain types of actions\n\n      switch (action.type) {\n        case actions.UPDATE_MEDIUM_ID:\n          {\n            trackParamChange({\n              medium: action.payload.mediumId\n            }, nextState);\n            return result;\n          }\n\n        case actions.UPDATE_ARTIST_ID:\n          {\n            trackParamChange({\n              artist: action.payload.artistId\n            }, nextState);\n            return result;\n          }\n\n        case actions.UPDATE_SORT:\n          {\n            trackParamChange({\n              sort: action.payload.sort\n            }, nextState);\n            return result;\n          }\n\n        case actions.UPDATE_ESTIMATE_RANGE:\n          {\n            trackParamChange({\n              price: nextState.artworkBrowser.filterParams.estimate_range\n            }, nextState);\n            return result;\n          }\n\n        default:\n          return result;\n      }\n    };\n  };\n};\n\nfunction trackableArtistIds(changed, filterParams) {\n  if ((0, _underscore.isEqual)(changed, {\n    artist: 'artists-you-follow'\n  })) {\n    return ['artists-you-follow'];\n  } else {\n    return filterParams.artist_ids;\n  }\n}\n\nfunction trackParamChange(changed, newState) {\n  var filterParams = newState.artworkBrowser.filterParams;\n  analyticsHooks.trigger('auction:artworks:params:change', {\n    current: [{\n      artists: trackableArtistIds(changed, filterParams)\n    }, {\n      medium: filterParams.gene_ids\n    }, {\n      sort: filterParams.sort\n    }, {\n      price: filterParams.estimate_range\n    }],\n    changed: changed\n  });\n}\n\nvar _default = analyticsMiddleware;\nexports.default = _default;",{"version":3,"sources":["src/desktop/apps/auction/utils/analyticsMiddleware.js"],"names":["analyticsHooks","analyticsMiddleware","result","next","action","nextState","store","getState","type","actions","UPDATE_MEDIUM_ID","trackParamChange","medium","payload","mediumId","UPDATE_ARTIST_ID","artist","artistId","UPDATE_SORT","sort","UPDATE_ESTIMATE_RANGE","price","artworkBrowser","filterParams","estimate_range","trackableArtistIds","changed","artist_ids","newState","trigger","current","artists","gene_ids"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AAEA;AACA,IAAIA,yCAAJ;;AAEA,IAAMC,sBAAsB,SAAtBA,mBAAsB;AAAA,SAAS;AAAA,WAAQ,kBAAU;AACrD,UAAMC,SAASC,KAAKC,MAAL,CAAf;AACA,UAAMC,YAAYC,MAAMC,QAAN,EAAlB,CAFqD,CAIrD;;AACA,cAAQH,OAAOI,IAAf;AACE,aAAKC,QAAQC,gBAAb;AAA+B;AAC7BC,6BAAiB;AAAEC,sBAAQR,OAAOS,OAAP,CAAeC;AAAzB,aAAjB,EAAsDT,SAAtD;AACA,mBAAOH,MAAP;AACD;;AACD,aAAKO,QAAQM,gBAAb;AAA+B;AAC7BJ,6BAAiB;AAAEK,sBAAQZ,OAAOS,OAAP,CAAeI;AAAzB,aAAjB,EAAsDZ,SAAtD;AACA,mBAAOH,MAAP;AACD;;AACD,aAAKO,QAAQS,WAAb;AAA0B;AACxBP,6BAAiB;AAAEQ,oBAAMf,OAAOS,OAAP,CAAeM;AAAvB,aAAjB,EAAgDd,SAAhD;AACA,mBAAOH,MAAP;AACD;;AACD,aAAKO,QAAQW,qBAAb;AAAoC;AAClCT,6BAAiB;AACfU,qBAAOhB,UAAUiB,cAAV,CAAyBC,YAAzB,CAAsCC;AAD9B,aAAjB,EAEGnB,SAFH;AAGA,mBAAOH,MAAP;AACD;;AACD;AAAS,iBAAOA,MAAP;AAnBX;AAqBD,KA1BoC;AAAA,GAAT;AAAA,CAA5B;;AA4BA,SAASuB,kBAAT,CAA6BC,OAA7B,EAAsCH,YAAtC,EAAoD;AAClD,MAAI,yBAAQG,OAAR,EAAiB;AAAEV,YAAQ;AAAV,GAAjB,CAAJ,EAAwD;AACtD,WAAO,CAAC,oBAAD,CAAP;AACD,GAFD,MAEO;AACL,WAAOO,aAAaI,UAApB;AACD;AACF;;AAED,SAAShB,gBAAT,CAA2Be,OAA3B,EAAoCE,QAApC,EAA8C;AAAA,MACpCL,YADoC,GACnBK,SAASN,cADU,CACpCC,YADoC;AAE5CvB,iBAAe6B,OAAf,CACE,gCADF,EAEE;AACEC,aAAS,CACP;AAAEC,eAASN,mBAAmBC,OAAnB,EAA4BH,YAA5B;AAAX,KADO,EAEP;AAAEX,cAAQW,aAAaS;AAAvB,KAFO,EAGP;AAAEb,YAAMI,aAAaJ;AAArB,KAHO,EAIP;AAAEE,aAAOE,aAAaC;AAAtB,KAJO,CADX;AAOEE;AAPF,GAFF;AAYD;;eAEczB,mB","file":"/Users/eve/development/force/src/desktop/apps/auction/utils/analyticsMiddleware.js","sourceRoot":"/Users/eve/development/force","sourcesContent":["import * as actions from 'desktop/apps/auction/actions/artworkBrowser'\nimport _analyticsHooks from 'desktop/lib/analytics_hooks.coffee'\nimport { isEqual } from 'underscore'\n\n// FIXME: Rewire\nlet analyticsHooks = _analyticsHooks\n\nconst analyticsMiddleware = store => next => action => {\n  const result = next(action)\n  const nextState = store.getState()\n\n  // track certain types of actions\n  switch (action.type) {\n    case actions.UPDATE_MEDIUM_ID: {\n      trackParamChange({ medium: action.payload.mediumId }, nextState)\n      return result\n    }\n    case actions.UPDATE_ARTIST_ID: {\n      trackParamChange({ artist: action.payload.artistId }, nextState)\n      return result\n    }\n    case actions.UPDATE_SORT: {\n      trackParamChange({ sort: action.payload.sort }, nextState)\n      return result\n    }\n    case actions.UPDATE_ESTIMATE_RANGE: {\n      trackParamChange({\n        price: nextState.artworkBrowser.filterParams.estimate_range\n      }, nextState)\n      return result\n    }\n    default: return result\n  }\n}\n\nfunction trackableArtistIds (changed, filterParams) {\n  if (isEqual(changed, { artist: 'artists-you-follow' })) {\n    return ['artists-you-follow']\n  } else {\n    return filterParams.artist_ids\n  }\n}\n\nfunction trackParamChange (changed, newState) {\n  const { filterParams } = newState.artworkBrowser\n  analyticsHooks.trigger(\n    'auction:artworks:params:change',\n    {\n      current: [\n        { artists: trackableArtistIds(changed, filterParams) },\n        { medium: filterParams.gene_ids },\n        { sort: filterParams.sort },\n        { price: filterParams.estimate_range }\n      ],\n      changed\n    }\n  )\n}\n\nexport default analyticsMiddleware\n"]}]}