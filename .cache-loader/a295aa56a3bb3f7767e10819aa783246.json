{"remainingRequest":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.js","dependencies":[{"path":"/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.js","mtime":1521820694000},{"path":"/Users/eve/development/force/.babelrc","mtime":1521064653000},{"path":"/Users/eve/development/force/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InfiniteScrollNewsArticle = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _getPrototypeOf = _interopRequireDefault(require(\"@babel/runtime/core-js/object/get-prototype-of\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactWaypoint = _interopRequireDefault(require(\"react-waypoint\"));\n\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\n\nvar _positronql2 = require(\"../../../lib/positronql\");\n\nvar _Publishing = require(\"@artsy/reaction/dist/Components/Publishing\");\n\nvar _articles = require(\"../queries/articles\");\n\nvar _FollowButton = require(\"./FollowButton.js\");\n\n(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\n// FIXME: Rewire\nvar positronql = _positronql2.positronql;\nvar FETCH_TOP_OFFSET = 200;\n\nvar InfiniteScrollNewsArticle =\n/*#__PURE__*/\nfunction (_Component) {\n  (0, _inherits2.default)(InfiniteScrollNewsArticle, _Component);\n\n  function InfiniteScrollNewsArticle(props) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, InfiniteScrollNewsArticle);\n    _this = (0, _possibleConstructorReturn2.default)(this, (InfiniteScrollNewsArticle.__proto__ || (0, _getPrototypeOf.default)(InfiniteScrollNewsArticle)).call(this, props));\n    Object.defineProperty((0, _assertThisInitialized2.default)(_this), \"fetchNextArticles\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function () {\n        var _value = (0, _asyncToGenerator2.default)(\n        /*#__PURE__*/\n        _regenerator.default.mark(function _callee() {\n          var _this$state, articles, following, offset, article, data, newArticles;\n\n          return _regenerator.default.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _this$state = _this.state, articles = _this$state.articles, following = _this$state.following, offset = _this$state.offset;\n                  article = _this.props.article;\n\n                  _this.setState({\n                    isLoading: true\n                  });\n\n                  _context.prev = 3;\n                  _context.next = 6;\n                  return positronql({\n                    query: (0, _articles.newsArticlesQuery)({\n                      offset: offset,\n                      limit: 6,\n                      omit: article.id\n                    })\n                  });\n\n                case 6:\n                  data = _context.sent;\n                  newArticles = data.articles;\n\n                  if (newArticles.length) {\n                    _this.setState({\n                      articles: articles.concat(newArticles),\n                      isLoading: false,\n                      offset: offset + 6\n                    });\n\n                    (0, _FollowButton.setupFollowButtons)(following);\n                  } else {\n                    _this.setState({\n                      isEnabled: false,\n                      isLoading: false\n                    });\n                  }\n\n                  _context.next = 15;\n                  break;\n\n                case 11:\n                  _context.prev = 11;\n                  _context.t0 = _context[\"catch\"](3);\n                  console.error('(apps/article/InfiniteScrollNewsArticle) Error fetching next article set: ', _context.t0);\n\n                  _this.setState({\n                    isEnabled: false,\n                    isLoading: false,\n                    error: true\n                  });\n\n                case 15:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, this, [[3, 11]]);\n        }));\n\n        return function value() {\n          return _value.apply(this, arguments);\n        };\n      }()\n    });\n    Object.defineProperty((0, _assertThisInitialized2.default)(_this), \"renderWaypoint\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        var _this$state2 = _this.state,\n            isEnabled = _this$state2.isEnabled,\n            isLoading = _this$state2.isLoading,\n            error = _this$state2.error;\n\n        if (isEnabled) {\n          if (!isLoading) {\n            return _react.default.createElement(_reactWaypoint.default, {\n              onEnter: _this.fetchNextArticles,\n              threshold: 2.0,\n              topOffset: FETCH_TOP_OFFSET\n            });\n          } else if (!error) {\n            return _react.default.createElement(LoadingSpinner, null, _react.default.createElement(\"div\", {\n              className: \"loading-spinner\"\n            }));\n          }\n        }\n      }\n    });\n    Object.defineProperty((0, _assertThisInitialized2.default)(_this), \"onEnter\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value(article, _ref) {\n        var previousPosition = _ref.previousPosition,\n            currentPosition = _ref.currentPosition;\n        var enteredArticle = previousPosition === 'above' && currentPosition === 'inside';\n\n        if (enteredArticle) {\n          document.title = article.thumbnail_title;\n          window.history.replaceState({}, article.id, \"/news/\".concat(article.slug));\n        }\n      }\n    });\n    Object.defineProperty((0, _assertThisInitialized2.default)(_this), \"onLeave\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value(i, _ref2) {\n        var previousPosition = _ref2.previousPosition,\n            currentPosition = _ref2.currentPosition;\n        var nextArticle = _this.state.articles[i + 1];\n\n        if (nextArticle && previousPosition === 'inside' && currentPosition === 'above') {\n          document.title = nextArticle.thumbnail_title;\n          window.history.replaceState({}, nextArticle.id, \"/news/\".concat(nextArticle.slug));\n        }\n      }\n    });\n    Object.defineProperty((0, _assertThisInitialized2.default)(_this), \"renderContent\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        var articles = _this.state.articles;\n        var _this$props = _this.props,\n            isMobile = _this$props.isMobile,\n            marginTop = _this$props.marginTop;\n        return (0, _lodash.flatten)(articles.map(function (article, i) {\n          return _react.default.createElement(\"div\", {\n            key: \"article-\".concat(i)\n          }, _react.default.createElement(_Publishing.Article, {\n            article: article,\n            isTruncated: i !== 0,\n            isMobile: isMobile,\n            marginTop: i === 0 ? marginTop : null\n          }), _react.default.createElement(_reactWaypoint.default, {\n            onEnter: function onEnter(waypointData) {\n              return _this.onEnter(article, waypointData);\n            },\n            onLeave: function onLeave(waypointData) {\n              return _this.onLeave(i, waypointData);\n            }\n          }));\n        }));\n      }\n    });\n    _this.state = {\n      isLoading: false,\n      articles: [props.article],\n      offset: 0,\n      error: false,\n      following: (0, _FollowButton.setupFollows)() || null,\n      isEnabled: true\n    };\n    return _this;\n  }\n\n  (0, _createClass2.default)(InfiniteScrollNewsArticle, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      (0, _FollowButton.setupFollowButtons)(this.state.following);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _react.default.createElement(\"div\", {\n        id: \"article-root\"\n      }, this.renderContent(), this.renderWaypoint());\n    }\n  }, {\n    key: \"__reactstandin__regenerateByEval\",\n    value: function __reactstandin__regenerateByEval(key, code) {\n      this[key] = eval(code);\n    }\n  }]);\n  return InfiniteScrollNewsArticle;\n}(_react.Component);\n\nexports.InfiniteScrollNewsArticle = InfiniteScrollNewsArticle;\nObject.defineProperty(InfiniteScrollNewsArticle, \"propTypes\", {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  value: {\n    article: _propTypes.default.object,\n    isMobile: _propTypes.default.bool,\n    marginTop: _propTypes.default.string\n  }\n});\n\nvar LoadingSpinner =\n/*#__PURE__*/\n_styledComponents.default.div.withConfig({\n  displayName: \"InfiniteScrollNewsArticle__LoadingSpinner\",\n  componentId: \"s1d8uupm-0\"\n})([\"position:relative;padding:100px;\"]);\n\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(positronql, \"positronql\", \"/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.js\");\n  reactHotLoader.register(FETCH_TOP_OFFSET, \"FETCH_TOP_OFFSET\", \"/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.js\");\n  reactHotLoader.register(InfiniteScrollNewsArticle, \"InfiniteScrollNewsArticle\", \"/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.js\");\n  reactHotLoader.register(LoadingSpinner, \"LoadingSpinner\", \"/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.js\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["src/desktop/apps/article/components/InfiniteScrollNewsArticle.js"],"names":["positronql","FETCH_TOP_OFFSET","InfiniteScrollNewsArticle","props","state","articles","following","offset","article","setState","isLoading","query","limit","omit","id","data","newArticles","length","concat","isEnabled","console","error","fetchNextArticles","previousPosition","currentPosition","enteredArticle","document","title","thumbnail_title","window","history","replaceState","slug","i","nextArticle","isMobile","marginTop","map","waypointData","onEnter","onLeave","renderContent","renderWaypoint","object","bool","string","LoadingSpinner","div"],"mappings":"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","file":"/Users/eve/development/force/src/desktop/apps/article/components/InfiniteScrollNewsArticle.js","sourceRoot":"/Users/eve/development/force","sourcesContent":["import React, { Component } from 'react'\nimport { flatten } from 'lodash'\nimport PropTypes from 'prop-types'\nimport Waypoint from 'react-waypoint'\nimport styled from 'styled-components'\nimport { positronql as _positronql } from 'desktop/lib/positronql'\nimport { Article } from 'reaction/Components/Publishing'\nimport { newsArticlesQuery } from 'desktop/apps/article/queries/articles'\nimport { setupFollows, setupFollowButtons } from './FollowButton.js'\n\n// FIXME: Rewire\nlet positronql = _positronql\n\nconst FETCH_TOP_OFFSET = 200\n\nexport class InfiniteScrollNewsArticle extends Component {\n  static propTypes = {\n    article: PropTypes.object,\n    isMobile: PropTypes.bool,\n    marginTop: PropTypes.string,\n  }\n\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      isLoading: false,\n      articles: [props.article],\n      offset: 0,\n      error: false,\n      following: setupFollows() || null,\n      isEnabled: true,\n    }\n  }\n\n  componentDidMount() {\n    setupFollowButtons(this.state.following)\n  }\n\n  fetchNextArticles = async () => {\n    const { articles, following, offset } = this.state\n    const { article } = this.props\n\n    this.setState({\n      isLoading: true,\n    })\n\n    try {\n      const data = await positronql({\n        query: newsArticlesQuery({\n          offset,\n          limit: 6,\n          omit: article.id,\n        }),\n      })\n\n      const newArticles = data.articles\n\n      if (newArticles.length) {\n        this.setState({\n          articles: articles.concat(newArticles),\n          isLoading: false,\n          offset: offset + 6,\n        })\n        setupFollowButtons(following)\n      } else {\n        this.setState({\n          isEnabled: false,\n          isLoading: false,\n        })\n      }\n    } catch (error) {\n      console.error(\n        '(apps/article/InfiniteScrollNewsArticle) Error fetching next article set: ',\n        error\n      )\n\n      this.setState({\n        isEnabled: false,\n        isLoading: false,\n        error: true,\n      })\n    }\n  }\n\n  renderWaypoint = () => {\n    const { isEnabled, isLoading, error } = this.state\n\n    if (isEnabled) {\n      if (!isLoading) {\n        return (\n          <Waypoint\n            onEnter={this.fetchNextArticles}\n            threshold={2.0}\n            topOffset={FETCH_TOP_OFFSET}\n          />\n        )\n      } else if (!error) {\n        return (\n          <LoadingSpinner>\n            <div className=\"loading-spinner\" />\n          </LoadingSpinner>\n        )\n      }\n    }\n  }\n\n  onEnter = (article, { previousPosition, currentPosition }) => {\n    const enteredArticle =\n      previousPosition === 'above' && currentPosition === 'inside'\n\n    if (enteredArticle) {\n      document.title = article.thumbnail_title\n      window.history.replaceState({}, article.id, `/news/${article.slug}`)\n    }\n  }\n\n  onLeave = (i, { previousPosition, currentPosition }) => {\n    const nextArticle = this.state.articles[i + 1]\n\n    if (\n      nextArticle &&\n      previousPosition === 'inside' &&\n      currentPosition === 'above'\n    ) {\n      document.title = nextArticle.thumbnail_title\n      window.history.replaceState(\n        {},\n        nextArticle.id,\n        `/news/${nextArticle.slug}`\n      )\n    }\n  }\n\n  renderContent = () => {\n    const { articles } = this.state\n    const { isMobile, marginTop } = this.props\n\n    return flatten(\n      articles.map((article, i) => {\n        return (\n          <div key={`article-${i}`}>\n            <Article\n              article={article}\n              isTruncated={i !== 0}\n              isMobile={isMobile}\n              marginTop={i === 0 ? marginTop : null}\n            />\n            <Waypoint\n              onEnter={(waypointData) => this.onEnter(article, waypointData)}\n              onLeave={(waypointData) => this.onLeave(i, waypointData)}\n            />\n          </div>\n        )\n      })\n    )\n  }\n\n  render() {\n    return (\n      <div id=\"article-root\">\n        {this.renderContent()}\n        {this.renderWaypoint()}\n      </div>\n    )\n  }\n}\n\nconst LoadingSpinner = styled.div`\n  position: relative;\n  padding: 100px;\n`\n"]}]}