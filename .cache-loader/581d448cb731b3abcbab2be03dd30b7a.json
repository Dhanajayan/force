{"remainingRequest":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js??ref--2-1!/Users/eve/development/force/src/desktop/analytics/article_impressions.js","dependencies":[{"path":"/Users/eve/development/force/src/desktop/analytics/article_impressions.js","mtime":1519227435000},{"path":"/Users/eve/development/force/.babelrc","mtime":1537178749000},{"path":"/Users/eve/development/force/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/force/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nvar $ = require('jquery');\n\nvar _ = require('underscore');\n\nif (location.pathname.match('/article/') || location.pathname.match('/articles')) {\n  var trackedImpressions = [];\n\n  var findVisibleItems = function findVisibleItems(articleItems) {\n    if (articleItems.length > 0) {\n      var items = $(articleItems).filter(function () {\n        var viewportTop = $(window).scrollTop();\n        var viewportBottom = viewportTop + $(window).height();\n        var itemTop = $(this).offset().top;\n        var itemBottom = itemTop + $(this).outerHeight(); // Either item top or item bottom is below the top\n        // of the browser and above the fold.\n\n        var topInView = itemTop > viewportTop && itemTop < viewportBottom;\n        var bottomInView = itemBottom > viewportTop && itemBottom < viewportBottom;\n        return topInView || bottomInView;\n      }).map(function () {\n        var classList = $(this).prop('classList');\n        var articleId = $(this).closest('.article-container').data('id'); // Editorial Signup\n\n        if (classList.contains('articles-es-cta__form')) {\n          if (location.pathname.match('/article/')) {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'article_fixed',\n              article_id: articleId,\n              destination_path: null,\n              id: 'article_fixed'\n            };\n          } else {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'magazine_fixed',\n              destination_path: null,\n              id: 'magazine_fixed'\n            };\n          }\n        } else if (classList.contains('article-es-form')) {\n          if ($(this).parents('.is-expanded')) {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'article_fixed',\n              article_id: articleId,\n              destination_path: null,\n              id: 'article_fixed'\n            };\n          } // Social\n\n        } else if (classList.contains('article-social')) {\n          var article = $(this).closest('.article-content');\n\n          if (article.hasClass('gradient-blurb') && article.hasClass('is-expanded') || !article.hasClass('gradient-blurb')) {\n            return {\n              article_id: articleId,\n              destination_path: null,\n              impression_type: 'social',\n              context_type: 'article_fixed',\n              id: 'social:' + articleId\n            };\n          }\n        } else if (classList.contains('article-share-fixed-fullscreen')) {\n          var indArticleId = $(this).data('id');\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'social',\n            context_type: 'article_fixed',\n            id: 'social:' + indArticleId // Image Set\n\n          };\n        } else if (classList.contains('article-section-image-set')) {\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'image_set',\n            context_type: 'article_fixed',\n            id: 'image_set:' + articleId + ':' + $(this).data('index') // Related Article\n\n          };\n        } else if (classList.contains('article-related-widget')) {\n          var related = $(this).find('a');\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'related_article',\n            context_type: 'article_fixed',\n            id: 'related_articles:' + trackRelatedLinks(related) // Artist Follow\n\n          };\n        } else if (classList.contains('artist-follow')) {\n          var _article = $(this).closest('.article-content');\n\n          if (_article.hasClass('gradient-blurb') && _article.hasClass('is-expanded') || !_article.hasClass('gradient-blurb')) {\n            if ($(this).parent('.image-set-modal__container').length > 0) {\n              return {\n                article_id: articleId,\n                destination_path: null,\n                impression_type: 'artist_follow',\n                context_type: 'article_fixed',\n                context_module: 'article_image_set',\n                id: 'artist_follow:' + 'image set' + ':' + $(this).data('id')\n              };\n            } else {\n              return {\n                article_id: articleId,\n                destination_path: null,\n                impression_type: 'artist_follow',\n                context_type: 'article_fixed',\n                context_module: 'article_artist_follow',\n                id: 'artist_follow:' + articleId + ':' + $(this).data('id')\n              };\n            }\n          }\n        } else if (classList.contains('article-section-callout') && $(this)[0].href) {\n          var destinationPath = $(this)[0].href.replace(/^.*\\/\\/[^\\/]+/, '');\n          return {\n            article_id: articleId,\n            destination_path: destinationPath,\n            impression_type: 'article_callout',\n            context_type: 'article_fixed',\n            id: 'article_callout:' + articleId + ':' + destinationPath\n          };\n        } else {}\n      }).toArray(); // Don't double track the same impressions\n\n      items = _.filter(items, function (item) {\n        return !_.contains(trackedImpressions, item.id);\n      });\n      trackedImpressions = trackedImpressions.concat(_.pluck(items, 'id')); // Return only the new impressions\n\n      return items;\n    } else {\n      return [];\n    }\n  };\n\n  var trackImpressions = function trackImpressions() {\n    var itemSelectors = '.articles-es-cta__form, .article-es-form,' + '.article-social, .article-share-fixed-fullscreen,' + '.article-section-image-set,' + '.article-section-toc, .article-sa-sticky-header.visible,' + '.article-sa-related,' + '.artist-follow,' + '.article-section-callout,' + '.article-related-widget';\n    var items = $(itemSelectors);\n    var visibleItems = findVisibleItems(items);\n\n    if (visibleItems.length > 0) {\n      visibleItems.map(function (item) {\n        trackImpression({\n          message: 'Article Impression',\n          context: item\n        });\n      });\n    }\n  };\n\n  var trackRelatedLinks = function trackRelatedLinks(related) {\n    var links = [];\n    related.map(function (i, link) {\n      links.push(link.href.replace(/^.*\\/\\/[^\\/]+/, ''));\n    });\n    return links;\n  };\n\n  var trackImpression = function trackImpression(item) {\n    analytics.track(item.message, item.context);\n  };\n\n  $(window).on('scroll', _.throttle(trackImpressions, 500));\n  analyticsHooks.on('view:image-set-item', function () {\n    trackImpressions();\n  });\n}\n\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(trackedImpressions, \"trackedImpressions\", \"/Users/eve/development/force/src/desktop/analytics/article_impressions.js\");\n  reactHotLoader.register(findVisibleItems, \"findVisibleItems\", \"/Users/eve/development/force/src/desktop/analytics/article_impressions.js\");\n  reactHotLoader.register(trackImpressions, \"trackImpressions\", \"/Users/eve/development/force/src/desktop/analytics/article_impressions.js\");\n  reactHotLoader.register(trackRelatedLinks, \"trackRelatedLinks\", \"/Users/eve/development/force/src/desktop/analytics/article_impressions.js\");\n  reactHotLoader.register(trackImpression, \"trackImpression\", \"/Users/eve/development/force/src/desktop/analytics/article_impressions.js\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["/Users/eve/development/force/src/desktop/analytics/article_impressions.js"],"names":["$","require","_","location","pathname","match","trackedImpressions","findVisibleItems","articleItems","length","items","filter","viewportTop","window","scrollTop","viewportBottom","height","itemTop","offset","top","itemBottom","outerHeight","topInView","bottomInView","map","classList","prop","articleId","closest","data","contains","impression_type","context_type","article_id","destination_path","id","parents","article","hasClass","indArticleId","related","find","trackRelatedLinks","parent","context_module","href","destinationPath","replace","toArray","item","concat","pluck","trackImpressions","itemSelectors","visibleItems","trackImpression","message","context","links","i","link","push","analytics","track","on","throttle","analyticsHooks"],"mappings":"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","sourcesContent":["const $ = require('jquery')\nconst _ = require('underscore')\n\nif (location.pathname.match('/article/') || location.pathname.match('/articles')) {\n  var trackedImpressions = []\n\n  var findVisibleItems = function (articleItems) {\n    if (articleItems.length > 0) {\n      var items = $(articleItems).filter(function () {\n        var viewportTop = $(window).scrollTop()\n        var viewportBottom = viewportTop + $(window).height()\n        var itemTop = $(this).offset().top\n        var itemBottom = itemTop + $(this).outerHeight()\n        // Either item top or item bottom is below the top\n        // of the browser and above the fold.\n        var topInView = itemTop > viewportTop && itemTop < viewportBottom\n        var bottomInView = itemBottom > viewportTop && itemBottom < viewportBottom\n\n        return topInView || bottomInView\n      }).map(function () {\n        var classList = $(this).prop('classList')\n        var articleId = $(this).closest('.article-container').data('id')\n        // Editorial Signup\n        if (classList.contains('articles-es-cta__form')) {\n          if (location.pathname.match('/article/')) {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'article_fixed',\n              article_id: articleId,\n              destination_path: null,\n              id: 'article_fixed'\n            }\n          } else {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'magazine_fixed',\n              destination_path: null,\n              id: 'magazine_fixed'\n            }\n          }\n        } else if (classList.contains('article-es-form')) {\n          if ($(this).parents('.is-expanded')) {\n            return {\n              impression_type: 'newsletter_signup',\n              context_type: 'article_fixed',\n              article_id: articleId,\n              destination_path: null,\n              id: 'article_fixed'\n            }\n          }\n\n        // Social\n        } else if (classList.contains('article-social')) {\n          const article = $(this).closest('.article-content')\n          if ((article.hasClass('gradient-blurb') && article.hasClass('is-expanded')) || !article.hasClass('gradient-blurb')) {\n            return {\n              article_id: articleId,\n              destination_path: null,\n              impression_type: 'social',\n              context_type: 'article_fixed',\n              id: 'social:' + articleId\n            }\n          }\n        } else if (classList.contains('article-share-fixed-fullscreen')) {\n          var indArticleId = $(this).data('id')\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'social',\n            context_type: 'article_fixed',\n            id: 'social:' + indArticleId\n          }\n\n        // Image Set\n        } else if (classList.contains('article-section-image-set')) {\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'image_set',\n            context_type: 'article_fixed',\n            id: 'image_set:' + articleId + ':' + $(this).data('index')\n          }\n\n        // Related Article\n        } else if (classList.contains('article-related-widget')) {\n          var related = $(this).find('a')\n          return {\n            article_id: articleId,\n            destination_path: null,\n            impression_type: 'related_article',\n            context_type: 'article_fixed',\n            id: 'related_articles:' + trackRelatedLinks(related)\n          }\n\n        // Artist Follow\n        } else if (classList.contains('artist-follow')) {\n          const article = $(this).closest('.article-content')\n          if ((article.hasClass('gradient-blurb') && article.hasClass('is-expanded')) || !article.hasClass('gradient-blurb')) {\n            if ($(this).parent('.image-set-modal__container').length > 0) {\n              return {\n                article_id: articleId,\n                destination_path: null,\n                impression_type: 'artist_follow',\n                context_type: 'article_fixed',\n                context_module: 'article_image_set',\n                id: 'artist_follow:' + 'image set' + ':' + $(this).data('id')\n              }\n            } else {\n              return {\n                article_id: articleId,\n                destination_path: null,\n                impression_type: 'artist_follow',\n                context_type: 'article_fixed',\n                context_module: 'article_artist_follow',\n                id: 'artist_follow:' + articleId + ':' + $(this).data('id')\n              }\n            }\n          }\n        } else if (classList.contains('article-section-callout') && $(this)[0].href) {\n          var destinationPath = $(this)[0].href.replace(/^.*\\/\\/[^\\/]+/, '')\n          return {\n            article_id: articleId,\n            destination_path: destinationPath,\n            impression_type: 'article_callout',\n            context_type: 'article_fixed',\n            id: 'article_callout:' + articleId + ':' + destinationPath\n          }\n        } else {\n          \n        }\n      }).toArray()\n\n      // Don't double track the same impressions\n      items = _.filter(items, function (item) {\n        return !(_.contains(trackedImpressions, item.id))\n      })\n      trackedImpressions = trackedImpressions.concat(_.pluck(items, 'id'))\n      // Return only the new impressions\n      return items\n    } else {\n      return []\n    }\n  }\n\n  var trackImpressions = function () {\n    var itemSelectors = '.articles-es-cta__form, .article-es-form,' +\n                        '.article-social, .article-share-fixed-fullscreen,' +\n                        '.article-section-image-set,' +\n                        '.article-section-toc, .article-sa-sticky-header.visible,' +\n                        '.article-sa-related,' +\n                        '.artist-follow,' +\n                        '.article-section-callout,' +\n                        '.article-related-widget'\n\n    var items = $(itemSelectors)\n    var visibleItems = findVisibleItems(items)\n    if (visibleItems.length > 0) {\n      visibleItems.map(function (item) {\n        trackImpression({ message: 'Article Impression', context: item })\n      })\n    }\n  }\n  var trackRelatedLinks = function (related) {\n    var links = []\n    related.map(function (i, link) {\n      links.push(link.href.replace(/^.*\\/\\/[^\\/]+/, ''))\n    })\n    return links\n  }\n\n  var trackImpression = function (item) {\n    analytics.track(item.message, item.context)\n  }\n\n  $(window).on('scroll', _.throttle(trackImpressions, 500))\n\n  analyticsHooks.on('view:image-set-item', function () {\n    trackImpressions()\n  })\n}\n"]}]}